<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Item Response Theory | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</title>
<meta name="author" content="R. Noah Padgett">
<meta name="description" content="Item response theory (IRT) builds models for item (stimuli that the measures collected) based on two broad classes of models Models for dichotomous (binary, 0/1) items and Models for polytomous...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 11 Item Response Theory | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy">
<meta property="og:type" content="book">
<meta property="og:description" content="Item response theory (IRT) builds models for item (stimuli that the measures collected) based on two broad classes of models Models for dichotomous (binary, 0/1) items and Models for polytomous...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Item Response Theory | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy">
<meta name="twitter:description" content="Item response theory (IRT) builds models for item (stimuli that the measures collected) based on two broad classes of models Models for dichotomous (binary, 0/1) items and Models for polytomous...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li class="book-part">Foundations</li>
<li><a class="" href="index.html"><span class="header-section-number">1</span> Index</a></li>
<li><a class="" href="chp2.html"><span class="header-section-number">2</span> Introduction to Bayesian Inference</a></li>
<li><a class="" href="conceptual-issues-in-bayesian-inference.html"><span class="header-section-number">3</span> Conceptual Issues in Bayesian Inference</a></li>
<li><a class="" href="normal-distribution-models.html"><span class="header-section-number">4</span> Normal Distribution Models</a></li>
<li><a class="" href="markov-chain-monte-carlo-estimation.html"><span class="header-section-number">5</span> Markov Chain Monte Carlo Estimation</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">6</span> Regression</a></li>
<li class="book-part">Psychometrics</li>
<li><a class="" href="canonical-bayesian-psychometric-modeling.html"><span class="header-section-number">7</span> Canonical Bayesian Psychometric Modeling</a></li>
<li><a class="" href="classical-test-theory.html"><span class="header-section-number">8</span> Classical Test Theory</a></li>
<li><a class="" href="confirmatory-factor-analysis.html"><span class="header-section-number">9</span> Confirmatory Factor Analysis</a></li>
<li><a class="" href="model-evaluation.html"><span class="header-section-number">10</span> Model Evaluation</a></li>
<li><a class="active" href="item-response-theory.html"><span class="header-section-number">11</span> Item Response Theory</a></li>
<li><a class="" href="missing-data-modeling.html"><span class="header-section-number">12</span> Missing Data Modeling</a></li>
<li><a class="" href="latent-class-analysis.html"><span class="header-section-number">13</span> Latent Class Analysis</a></li>
<li><a class="" href="bayesian-networks.html"><span class="header-section-number">14</span> Bayesian Networks</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="item-response-theory" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Item Response Theory<a class="anchor" aria-label="anchor" href="#item-response-theory"><i class="fas fa-link"></i></a>
</h1>
<p>Item response theory (IRT) builds models for item (stimuli that the measures collected) based on two broad classes of models</p>
<ol style="list-style-type: decimal">
<li>Models for dichotomous (binary, 0/1) items and</li>
<li>Models for polytomous (multi-category) items.</li>
</ol>
<div id="irt-models-for-dichotomous-data" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> IRT Models for Dichotomous Data<a class="anchor" aria-label="anchor" href="#irt-models-for-dichotomous-data"><i class="fas fa-link"></i></a>
</h2>
<p>First, for conventional dichotomous observed variables, an IRT model can be generally specified as follows.</p>
<p>Let <span class="math inline">\(x_{ij}\)</span> be the observed value from respondent <span class="math inline">\(i\)</span> on observable (item) <span class="math inline">\(j\)</span>.
When <span class="math inline">\(x\)</span> is binary, the observed value can be <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>.
Some common IRT models for binary observed variables can be expressed as a version of</p>
<p><span class="math display">\[p(x_{ij} = 1 \mid \theta_i, d_j, a_j, c_j) = c_j + (1-c_j)F(a_j \theta_i + d_j),\]</span></p>
<p>where,</p>
<ul>
<li>
<span class="math inline">\(\theta_i\)</span> is the magnitude of the latent variable that individual <span class="math inline">\(i\)</span> possesses. In educational measurement, <span class="math inline">\(\theta_i\)</span> commonly represents proficiency so that a higher <span class="math inline">\(\theta_i\)</span> means that individual has more of the trait,</li>
<li>
<span class="math inline">\(d_j\)</span> is the item location or difficulty parameter. <span class="math inline">\(d_j\)</span> is commonly transformed to be <span class="math inline">\(d_j = -a_jb_j\)</span> so that the location parameter is easier to interpret in relation to the latent trait <span class="math inline">\(\theta_i\)</span>,</li>
<li>
<span class="math inline">\(a_j\)</span> is the item slope or discrimination parameter,</li>
<li>
<span class="math inline">\(c_j\)</span> is the item lower asymptote or guessing parameter,</li>
<li>
<span class="math inline">\(F(.)\)</span> is the link function to be specified that determines the form of the transformation between latent trait and the item response probability. The link is common chosen to be either the logistic link or the normal-ogive link.</li>
</ul>
<p>Common IRT models are the</p>
<ul>
<li>1-PL, or one-parameter logistic model, which only uses one measurement parameter <span class="math inline">\(d_j\)</span> per item,</li>
<li>2-PL, or two-parameter logistic model, which uses two measurement model parameters <span class="math inline">\(a_j\)</span> and <span class="math inline">\(d_j\)</span> per item,</li>
<li>3-PL, or three-parameter logistic model, which uses all three parameters as shown above.</li>
<li>other models are also possible for binary item response formats but are omitted here.</li>
</ul>
<p>The above describes the functional form used to model why individual may have a greater or lesser likelihood of endorsing an item (have a <span class="math inline">\(1\)</span> as a measure).
We use the above model as the basis for defining the conditional probability of any response given the values of the parameters.
The conditional probability is then commonly used as part of a <em>marginal maximum likelihood (MML)</em> approach to finding parameters values for the measurement model which maximize the likelihood.
However, given that the values of the latent variable <span class="math inline">\(\theta_i\)</span> are also unknown, the distribution of <span class="math inline">\(\theta_i\)</span> is marginalized out of the likelihood function.</p>
<p>However, in the Bayesian formulation, we can side-step some of these issues by the use of prior distributions.
Starting with the general form of the likelihood function
<span class="math display">\[p(\mathbf{x}\mid \boldsymbol{\theta}, \boldsymbol{\omega}) = \prod_{i=1}^np(\mathbf{x}_i\mid \theta_i, \boldsymbol{\omega}) = \prod_{i=1}^n\prod_{j=1}^Jp(x_{ij}\mid \theta_i, \boldsymbol{\omega}_j),\]</span>
where
<span class="math display">\[x_{ij}\mid \theta_i, \boldsymbol{\omega}_j \sim \mathrm{Bernoulli}[p(x_{ij}\mid \theta_i, \boldsymbol{\omega}_j)].\]</span></p>
<p>Developing a joint prior distribution for <span class="math inline">\(p(\boldsymbol{\theta}, \boldsymbol{\omega})\)</span> is not straightforward given the high dimensional aspect of the components.
But, a common assumption is that the distribution for the latent variables (<span class="math inline">\(\boldsymbol{\theta}\)</span>) is independent of the distribution for the measurement model parameters (<span class="math inline">\(\boldsymbol{\omega}\)</span>).
That is, we can separate the problem into independent priors
<span class="math display">\[p(\boldsymbol{\theta}, \boldsymbol{\omega}) = p(\boldsymbol{\theta})p(\boldsymbol{\omega}).\]</span></p>
<p>For the latent variables, the prior distributuion is generally build by assuming that all individuals are also independent.
The independence of observations leads to a joint prior that is a product of priors with a common distribution,
<span class="math display">\[p(\boldsymbol{\theta}) = \prod_{i=1}^np(\theta_i\mid \boldsymbol{\theta}_p),\]</span>
where <span class="math inline">\(\boldsymbol{\theta}_p\)</span> are the hyperparameters governing the common prior for the latent variable distribution.
A common choice is that <span class="math inline">\(\theta_i \sim \mathrm{Normal}(\mu_{\theta} = 0, \sigma^2_{\theta}=1)\)</span> because the distribution is arbitrary.</p>
<p>For the measurement model parameters, a bit more complex specification is generally needed.
One <em>simple</em> approach would be to invoke an exchangeability assumption among items and among item parameters.
This would essentially make all priors independent and simplify the specification to product of univariate priors over all measurement model parameters
<span class="math display">\[p(\boldsymbol{\omega}) = \prod_{j=1}^Jp(\boldsymbol{\omega}_j)=\prod_{j=1}^Jp(d_j)p(a_j)p(c_j).\]</span>
For for location parameter (<span class="math inline">\(d_j\)</span>), a common prior distribution is an unbounded normal distribution.
Because, the location can take on any value within the range of the latent variable which is also technically unbounded so we let
<span class="math display">\[d_j \sim \mathrm{Normal}(\mu_{d},\sigma^2_d).\]</span>
The choice of hyperparameters can be guided by prior research or set to a common relative diffuse value for all items such as <span class="math inline">\(\mu_{d}=0,\sigma^2_d=10\)</span>.</p>
<p>The discrimination parameter governs the strength of the relationship between the latent variable and the probability of endorsing the item.
This is similar in flavor to a factor loading in CFA.
An issue with specifying a prior for the discrimination parameter is the indeterminacy with respect the the orientation of the latent variable.
In CFA, we resolved the orientation indeterminacy issue by fixing one factor loading to 1.
In IRT, we can do so by constraining the possible values of the discrimination parameters to be strictly positive.
This forces each item to have the meaning of higher values on the latent variable directly (or at least proportionally) increase the probability of endorsing the item.
We achieve this by using a prior such as
<span class="math display">\[a_j \sim \mathrm{Normal}^{+}(\mu_a,\sigma^2_a).\]</span>
The term <span class="math inline">\(\mathrm{Normal}^{+}(.)\)</span> means that the normal distribution is truncated at 0 so that only positive values are possible.</p>
<p>Lastly, the guessing parameter <span class="math inline">\(c_j\)</span> takes on values between <span class="math inline">\([0,1]\)</span>.
A common choice for parameters bounded between 0 and 1 is a Beta prior, that is
<span class="math display">\[c_j \sim \mathrm{Beta}(\alpha_c, \beta_c).\]</span>
The hyperparameters <span class="math inline">\(\alpha_c\)</span> and <span class="math inline">\(\beta_c\)</span> determine the shape of the beta prior and affect the likelihood and magnitude of guessing parameters.</p>
</div>
<div id="pl-lsat-example" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> 3-PL LSAT Example<a class="anchor" aria-label="anchor" href="#pl-lsat-example"><i class="fas fa-link"></i></a>
</h2>
<p>In the Law School Admission Test (LSAT) example (p. 263-271), the data are from 1000 examinees responding to five items which is just a subset of the LSAT.
We hypothesize that only one underlying latent variable is measured by these items.
But that guessing is also plausible.
The full 3-PL model we will use can be described in an equation as
<span class="math display">\[p(\boldsymbol{\theta}, \boldsymbol{d}, \boldsymbol{a}, \boldsymbol{c} \mid \mathbf{x}) \propto \prod_{i=1}^n\prod_{j=1}^Jp(\theta_i\mid\theta_i, d_j, a_j, c_j)p(\theta_i)p(d_j)p(a_j)p(c_j),\]</span>
where
<span class="math display">\[\begin{align*}
x_{ij}\mid\theta_i\mid\theta_i, d_j, a_j, c_j &amp;\sim \mathrm{Bernoulli}[p(\theta_i\mid\theta_i, d_j, a_j, c_j)],\ \mathrm{for}\ i=1, \cdots, 100,\ j = 1, \cdots, 5;\\
p(\theta_i\mid\theta_i, d_j, a_j, c_j) &amp;= c_j + (1-c_j)\Phi(a_j\theta_j + d_j),\ \mathrm{for}\ i=1, \cdots, 100,\ j = 1, \cdots, 5;\\
\theta_i &amp;\sim \mathrm{Normal}(0,1),\ \mathrm{for}\ i = 1, \cdots, 1000;\\
d_j &amp;\sim \mathrm{Normal}(0, 2),\ \mathrm{for}\ j=1, \cdots, 5;\\
a_j &amp;\sim \mathrm{Normal}^{+}(1, 2),\ \mathrm{for}\ j=1, \cdots, 5;\\
c_j &amp;\sim \mathrm{Beta}(5, 17),\ \mathrm{for}\ j=1, \cdots, 5.
\end{align*}\]</span></p>
<p>The above model can illustrated in a DAG as shown below.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp11-dag-1"></span>
<img src="dag/chp11-irt1.png" alt="DAG for 3-PL IRT model for LSAT Example" width="75%" height="90%"><p class="caption">
Figure 11.1: DAG for 3-PL IRT model for LSAT Example
</p>
</div>
<p>The path diagram for an IRT is essentially identical to the path diagram for a CFA model.
This fact highlights an important feature of IRT/CFA in that the major conceptual difference between these approaches to is how we define the link between the latent variable the observed items.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp11-pathdiag-1"></span>
<img src="path-diagram/chp11-irt1.png" alt="Path diagram for 3-PL IRT model" width="90%" height="90%"><p class="caption">
Figure 11.2: Path diagram for 3-PL IRT model
</p>
</div>
<p>For completeness, I have included the model specification diagram that more concretely connects the DAG and path diagram to the assumed distributions and priors.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp11-spec-1"></span>
<img src="model-spec/chp11-irt1.png" alt="Model specification diagram for the 3-PL IRT model" width="90%" height="90%"><p class="caption">
Figure 11.3: Model specification diagram for the 3-PL IRT model
</p>
</div>
</div>
<div id="lsat-example---jags" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> LSAT Example - JAGS<a class="anchor" aria-label="anchor" href="#lsat-example---jags"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jags.model.lsat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>

<span class="co">#########################################</span>
<span class="co"># Specify the item response measurement model for the observables</span>
<span class="co">#########################################</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">c</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">c</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="fu">phi</span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">*</span><span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">d</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>       <span class="co"># 3P-NO expression</span>
    <span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu">dbern</span><span class="op">(</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>                  <span class="co"># distribution for each observable</span>
  <span class="op">}</span>
<span class="op">}</span>


<span class="co">##########################################</span>
<span class="co"># Specify the (prior) distribution for the latent variables</span>
<span class="co">##########################################</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># distribution for the latent variables</span>
<span class="op">}</span>


<span class="co">##########################################</span>
<span class="co"># Specify the prior distribution for the measurement model parameters</span>
<span class="co">##########################################</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
  <span class="va">d</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span><span class="op">)</span>          <span class="co"># Locations for observables</span>
  <span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">)</span>    <span class="co"># Discriminations for observables</span>
  <span class="va">c</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">17</span><span class="op">)</span>           <span class="co"># Lower asymptotes for observables</span>
  
<span class="op">}</span>


<span class="op">}</span> <span class="co"># closes the model</span>

<span class="co"># initial values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span>,
       <span class="st">"c"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"c"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,
       <span class="st">"c"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"theta"</span><span class="op">)</span>

<span class="co"># dataset</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/LSAT.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>
  model.file<span class="op">=</span><span class="va">jags.model.lsat</span>,
  data<span class="op">=</span><span class="va">mydata</span>,
  inits<span class="op">=</span><span class="va">start_values</span>,
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  n.iter<span class="op">=</span><span class="fl">2000</span>,
  n.burnin <span class="op">=</span> <span class="fl">1000</span>,
  n.chains <span class="op">=</span> <span class="fl">3</span>,
  progress.bar <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## module glm loaded</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 5000
##    Unobserved stochastic nodes: 1015
##    Total graph size: 31027
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print(fit)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span> <span class="op">%like%</span> <span class="st">"theta"</span>, <span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>##              mean     sd     2.5%      25%      50%      75%    97.5%  Rhat n.eff
## a[1]        0.455  0.163    0.194    0.341    0.437    0.544    0.813 1.030    85
## a[2]        0.680  0.407    0.298    0.447    0.563    0.713    1.834 1.181    24
## a[3]        1.231  0.675    0.433    0.753    1.055    1.524    2.968 1.090    55
## a[4]        0.480  0.149    0.232    0.367    0.469    0.575    0.805 1.018   140
## a[5]        0.459  0.158    0.181    0.350    0.441    0.549    0.818 1.006   740
## c[1]        0.238  0.096    0.081    0.169    0.229    0.295    0.460 1.002  2300
## c[2]        0.270  0.111    0.097    0.187    0.252    0.340    0.515 1.120    24
## c[3]        0.275  0.077    0.108    0.227    0.284    0.330    0.407 1.023   100
## c[4]        0.240  0.091    0.091    0.176    0.228    0.294    0.454 1.001  3000
## c[5]        0.238  0.092    0.090    0.169    0.229    0.298    0.441 1.004  3000
## d[1]        1.408  0.135    1.130    1.325    1.409    1.487    1.693 1.010   320
## d[2]        0.243  0.267   -0.565    0.167    0.316    0.410    0.538 1.288    16
## d[3]       -0.563  0.405   -1.495   -0.778   -0.475   -0.277    0.016 1.098    30
## d[4]        0.530  0.134    0.186    0.466    0.548    0.620    0.741 1.001  3000
## d[5]        1.043  0.119    0.785    0.972    1.051    1.124    1.253 1.020   620
## deviance 4518.533 69.740 4362.905 4475.720 4523.581 4565.875 4645.075 1.082    35</code></pre>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract posteriors for all chains</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu">as.mcmc</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="co"># the below two plots are too big to be useful given the 1000 observations.</span>
<span class="co">#R2jags::traceplot(jags.mcmc)</span>

<span class="co"># gelman-rubin-brook</span>
<span class="co">#gelman.plot(jags.mcmc)</span>

<span class="co"># convert to single data.frame for density plot</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">jags.mcmc</span>, chains<span class="op">=</span><span class="cn">T</span>, iters <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"chain"</span>, <span class="st">"iter"</span>, <span class="va">a</span><span class="op">)</span>


<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">mcmc_acf</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_grb.html">ggs_grb</a></span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"d"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-4.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">mcmc_acf</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-5.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-6.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_grb.html">ggs_grb</a></span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"a"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-7.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span> <span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-8.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">mcmc_acf</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"c["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-9.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"c["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-10.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_grb.html">ggs_grb</a></span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"c"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-11.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"c["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-12.png" width="90%" height="90%"></div>
<div id="posterior-predicted-distributions" class="section level3" number="11.3.1">
<h3>
<span class="header-section-number">11.3.1</span> Posterior Predicted Distributions<a class="anchor" aria-label="anchor" href="#posterior-predicted-distributions"><i class="fas fa-link"></i></a>
</h3>
<p>Here, we want to compare the observed and expected posterior predicted distributions.</p>
<p>Statistical functions of interest are the (1) standardized model-based covariance (SMBC) and (2) the standardized generalized discrepancy measure (SGDDM).</p>
<p>For (1), the SMBC is
<span class="math display">\[SMBC_{jj^\prime}=\frac{\frac{1}{n}\sum_{i=1}^n(x_{ij} - E(x_{ij} \mid \theta_i,\boldsymbol{\omega}_j))(x_{ij^\prime} - E(x_{ij^\prime} \mid \theta_i,\boldsymbol{\omega}_j^\prime))}{\sqrt{\frac{1}{n}\sum_{i=1}^n(x_{ij} - E(x_{ij} \mid \theta_i,\boldsymbol{\omega}_j))^2}\sqrt{\frac{1}{n}\sum_{i=1}^n(x_{ij^\prime} - E(x_{ij^\prime} \mid \theta_i,\boldsymbol{\omega}_j^\prime))}}\]</span></p>
<p>In R, the functions below can be used to compute these qualtities.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calculate.SGDDM</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data.matrix</span>, <span class="va">expected.value.matrix</span><span class="op">)</span><span class="op">{</span>
    
    <span class="va">J.local</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data.matrix</span><span class="op">)</span>

    <span class="va">SMBC.matrix</span> <span class="op">&lt;-</span> <span class="fu">calculate.SMBC.matrix</span><span class="op">(</span><span class="va">data.matrix</span>, <span class="va">expected.value.matrix</span><span class="op">)</span>
    
    <span class="va">SGDDM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">SMBC.matrix</span>, diag<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">SMBC.matrix</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="va">J.local</span><span class="op">*</span><span class="op">(</span><span class="va">J.local</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>

    <span class="va">SGDDM</span>

<span class="op">}</span> <span class="co"># closes calculate.SGDDM</span>

<span class="va">calculate.SMBC.matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data.matrix</span>, <span class="va">expected.value.matrix</span><span class="op">)</span><span class="op">{</span>
    
    <span class="va">N.local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data.matrix</span><span class="op">)</span>

    <span class="va">MBC.matrix</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">data.matrix</span><span class="op">-</span><span class="va">expected.value.matrix</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="op">(</span><span class="va">data.matrix</span><span class="op">-</span><span class="va">expected.value.matrix</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">N.local</span>

    <span class="va">MBStddevs.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">MBC.matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

    <span class="co">#SMBC.matrix &lt;- solve(MBStddevs.matrix) %*% MBC.matrix %*% solve(MBStddevs.matrix)</span>


    <span class="va">J.local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data.matrix</span><span class="op">)</span>

    <span class="va">SMBC.matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">J.local</span>, ncol<span class="op">=</span><span class="va">J.local</span><span class="op">)</span>

    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J.local</span><span class="op">)</span><span class="op">{</span>
        <span class="kw">for</span><span class="op">(</span><span class="va">jj</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J.local</span><span class="op">)</span><span class="op">{</span>
            <span class="va">SMBC.matrix</span><span class="op">[</span><span class="va">j</span>,<span class="va">jj</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">MBC.matrix</span><span class="op">[</span><span class="va">j</span>,<span class="va">jj</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">MBStddevs.matrix</span><span class="op">[</span><span class="va">j</span>,<span class="va">j</span><span class="op">]</span><span class="op">*</span><span class="va">MBStddevs.matrix</span><span class="op">[</span><span class="va">jj</span>,<span class="va">jj</span><span class="op">]</span><span class="op">)</span>
        <span class="op">}</span>
    <span class="op">}</span>

    <span class="va">SMBC.matrix</span> 

<span class="op">}</span> <span class="co"># closes calculate.MBC.matrix</span></code></pre></div>
<p>Next, we will use the functions above among other basic data wrangling to construct a full posterior predictive distribution analysis to probe our resulting posterior.</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data wrangle the results/posterior draws for use</span>
<span class="va">datv1</span> <span class="op">&lt;-</span> <span class="va">plot.data</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="va">`a[1]`</span><span class="op">:</span><span class="va">`a[5]`</span>,
    values_to <span class="op">=</span> <span class="st">"a"</span>,
    names_to <span class="op">=</span> <span class="st">"item"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">item</span>, <span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">item</span>, <span class="va">a</span><span class="op">)</span>
<span class="va">datv2</span> <span class="op">&lt;-</span> <span class="va">plot.data</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="va">`c[1]`</span><span class="op">:</span><span class="va">`c[5]`</span>,
    values_to <span class="op">=</span> <span class="st">"c"</span>,
    names_to <span class="op">=</span> <span class="st">"item"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">item</span>, <span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">item</span>, <span class="va">c</span><span class="op">)</span>
<span class="va">datv3</span> <span class="op">&lt;-</span> <span class="va">plot.data</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="va">`d[1]`</span><span class="op">:</span><span class="va">`d[5]`</span>,
    values_to <span class="op">=</span> <span class="st">"d"</span>,
    names_to <span class="op">=</span> <span class="st">"item"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">item</span>, <span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">item</span>, <span class="va">d</span><span class="op">)</span>

<span class="va">datv4</span> <span class="op">&lt;-</span> <span class="va">plot.data</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="va">`theta[1]`</span><span class="op">:</span><span class="va">`theta[999]`</span>,
    values_to <span class="op">=</span> <span class="st">"theta"</span>,
    names_to <span class="op">=</span> <span class="st">"person"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">person</span>, <span class="va">theta</span><span class="op">)</span>

<span class="va">dat_long</span> <span class="op">&lt;-</span> <span class="fu">full_join</span><span class="op">(</span><span class="va">datv1</span>, <span class="va">datv2</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = c("chain", "iter", "item")</code></pre>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_long</span> <span class="op">&lt;-</span> <span class="fu">full_join</span><span class="op">(</span><span class="va">dat_long</span>, <span class="va">datv3</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = c("chain", "iter", "item")</code></pre>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_long</span> <span class="op">&lt;-</span> <span class="fu">full_join</span><span class="op">(</span><span class="va">dat_long</span>, <span class="va">datv4</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = c("chain", "iter")</code></pre>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">dat</span>
<span class="va">dat1</span><span class="op">$</span><span class="va">person</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"theta["</span>,<span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span>
<span class="va">datvl</span> <span class="op">&lt;-</span> <span class="va">dat1</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols<span class="op">=</span><span class="fu">contains</span><span class="op">(</span><span class="st">"item"</span><span class="op">)</span>,
    names_to <span class="op">=</span> <span class="st">"item"</span>,
    values_to <span class="op">=</span> <span class="st">"x"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">item</span>, <span class="fl">6</span>, <span class="fl">100</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">dat_long</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">dat_long</span>, <span class="va">datvl</span><span class="op">)</span></code></pre></div>
<pre><code>## Joining, by = c("item", "person")</code></pre>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compute expected prob</span>
<span class="va">ilogit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>
<span class="va">dat_long</span> <span class="op">&lt;-</span> <span class="va">dat_long</span> <span class="op">%&gt;%</span>
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    x.exp <span class="op">=</span> <span class="va">c</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">c</span><span class="op">)</span><span class="op">*</span><span class="fu">ilogit</span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="op">(</span><span class="va">theta</span> <span class="op">-</span> <span class="va">d</span><span class="op">)</span><span class="op">)</span>,
    x.dif <span class="op">=</span> <span class="va">x</span> <span class="op">-</span> <span class="va">x.exp</span>
  <span class="op">)</span>


<span class="va">dat_long</span><span class="op">$</span><span class="va">x.ppd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span>
  <span class="va">dat_long</span>, <span class="fl">1</span>, 
  FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">rbern</span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="op">)</span>
<span class="va">itermin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dat_long</span><span class="op">$</span><span class="va">iter</span><span class="op">)</span> <span class="co"># used for subseting</span>
<span class="co"># figure 11.4</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="va">dat_long</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">person</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>raw.score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
            raw.score.ppd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x.ppd</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'chain', 'iter'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">di</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">chain</span><span class="op">==</span><span class="fl">1</span>, <span class="va">iter</span><span class="op">==</span><span class="fl">1001</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">raw.score</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">dii</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">raw.score.ppd</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>raw.score <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'chain', 'iter'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># overall fit of observed scores</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">dii</span>, <span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="va">raw.score</span>, x<span class="op">=</span> <span class="va">raw.score.ppd</span>, group<span class="op">=</span><span class="va">raw.score.ppd</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">di</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">raw.score</span>, y<span class="op">=</span><span class="va">count</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Raw Score"</span>, y<span class="op">=</span><span class="st">"Number of Examinees"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-ppd-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># by item</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="va">dat_long</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">person</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>raw.score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
         raw.score.ppd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x.ppd</span><span class="op">)</span><span class="op">)</span>

<span class="va">di</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">chain</span><span class="op">==</span><span class="fl">1</span>, <span class="va">iter</span><span class="op">==</span><span class="fl">1001</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">raw.score</span>, <span class="va">item</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>p.correct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'raw.score'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dii</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span>, <span class="va">iter</span>, <span class="va">raw.score.ppd</span>, <span class="va">item</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>p.correct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x.ppd</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'chain', 'iter', 'raw.score.ppd'. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">dii</span>,
               <span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span> <span class="va">p.correct</span>,
                   x<span class="op">=</span> <span class="va">raw.score.ppd</span>,
                   group<span class="op">=</span><span class="va">raw.score.ppd</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">di</span>,
             <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">raw.score</span>, y<span class="op">=</span><span class="va">p.correct</span><span class="op">)</span>,
             color<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">item</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Raw Score"</span>, y<span class="op">=</span><span class="st">"Number of Examinees"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-ppd-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># computing standardized model summary statistics</span>
<span class="co"># objects for results</span>
<span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">5</span>
<span class="va">n.chain</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">n.iters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dat_long</span><span class="op">$</span><span class="va">iter</span><span class="op">)</span><span class="op">)</span>
<span class="va">n.iters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">long_dat</span><span class="op">$</span><span class="va">iter</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in unique(long_dat$iter): object 'long_dat' not found</code></pre>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n.iters.PPMC</span> <span class="op">&lt;-</span> <span class="va">n.iters</span><span class="op">*</span><span class="va">n.chain</span>

<span class="va">realized.SMBC.array</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n.iters.PPMC</span>, <span class="va">J</span>, <span class="va">J</span><span class="op">)</span><span class="op">)</span>
<span class="va">postpred.SMBC.array</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n.iters.PPMC</span>, <span class="va">J</span>, <span class="va">J</span><span class="op">)</span><span class="op">)</span>
<span class="va">realized.SGDDM.vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n.iters.PPMC</span><span class="op">)</span><span class="op">)</span>
<span class="va">postpred.SGDDM.vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n.iters.PPMC</span><span class="op">)</span><span class="op">)</span>



<span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="co"># iteration condiitons</span>
<span class="va">iter.cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dat_long</span><span class="op">$</span><span class="va">iter</span><span class="op">)</span>
<span class="va">Xobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">iter.cond</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>
  <span class="va">cc</span> <span class="op">&lt;-</span> <span class="va">iter.cond</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">Xexp</span> <span class="op">&lt;-</span> <span class="va">dat_long</span><span class="op">[</span><span class="va">dat_long</span><span class="op">$</span><span class="va">chain</span><span class="op">==</span><span class="va">c</span> <span class="op">&amp;</span> <span class="va">dat_long</span><span class="op">$</span><span class="va">iter</span><span class="op">==</span><span class="va">cc</span> , <span class="op">]</span> <span class="op">%&gt;%</span>
    <span class="fu">pivot_wider</span><span class="op">(</span>
      id_cols <span class="op">=</span> <span class="va">person</span>,
      names_from <span class="op">=</span> <span class="st">"item"</span>,
      values_from <span class="op">=</span> <span class="st">"x.exp"</span>,
      names_prefix <span class="op">=</span> <span class="st">"item"</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu">select</span><span class="op">(</span><span class="va">item1</span><span class="op">:</span><span class="va">item5</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">Xppd</span> <span class="op">&lt;-</span> <span class="va">dat_long</span><span class="op">[</span><span class="va">dat_long</span><span class="op">$</span><span class="va">chain</span><span class="op">==</span><span class="va">c</span> <span class="op">&amp;</span> <span class="va">dat_long</span><span class="op">$</span><span class="va">iter</span><span class="op">==</span><span class="va">cc</span> , <span class="op">]</span> <span class="op">%&gt;%</span>
    <span class="fu">pivot_wider</span><span class="op">(</span>
      id_cols <span class="op">=</span> <span class="va">person</span>,
      names_from <span class="op">=</span> <span class="st">"item"</span>,
      values_from <span class="op">=</span> <span class="st">"x.ppd"</span>,
      names_prefix <span class="op">=</span> <span class="st">"item"</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu">select</span><span class="op">(</span><span class="va">item1</span><span class="op">:</span><span class="va">item5</span><span class="op">)</span><span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>

  <span class="co"># compute realized values</span>
  <span class="va">realized.SMBC.array</span><span class="op">[</span><span class="va">ii</span>, ,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">calculate.SMBC.matrix</span><span class="op">(</span><span class="va">Xobs</span>, <span class="va">Xexp</span><span class="op">)</span>
  <span class="va">realized.SGDDM.vector</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">calculate.SGDDM</span><span class="op">(</span><span class="va">Xobs</span>, <span class="va">Xexp</span><span class="op">)</span>
  <span class="co"># compute PPD values</span>
  <span class="va">postpred.SMBC.array</span><span class="op">[</span><span class="va">ii</span>, ,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">calculate.SMBC.matrix</span><span class="op">(</span><span class="va">Xppd</span>, <span class="va">Xexp</span><span class="op">)</span>
  <span class="va">postpred.SGDDM.vector</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu">calculate.SGDDM</span><span class="op">(</span><span class="va">Xppd</span>, <span class="va">Xexp</span><span class="op">)</span>
    <span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">ii</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="op">}</span>
<span class="op">}</span>


<span class="va">plot.dat.ppd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  real <span class="op">=</span> <span class="va">realized.SGDDM.vector</span>,
  ppd <span class="op">=</span> <span class="va">postpred.SGDDM.vector</span>
<span class="op">)</span>


<span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.dat.ppd</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">real</span>, y<span class="op">=</span><span class="va">ppd</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-ppd-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># transform smbc into plotable format</span>
<span class="va">ddim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">postpred.SMBC.array</span><span class="op">)</span>
<span class="va">plot.dat.ppd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow<span class="op">=</span><span class="va">ddim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">ddim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">ddim</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plot.dat.ppd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"itemj"</span>, <span class="st">"itemjj"</span>, <span class="st">"real"</span>, <span class="st">"ppd"</span><span class="op">)</span>
<span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">jj</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ddim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ddim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">jj</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">ddim</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>
      <span class="va">plot.dat.ppd</span><span class="op">[</span><span class="va">ii</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">j</span>
      <span class="va">plot.dat.ppd</span><span class="op">[</span><span class="va">ii</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">jj</span>
      <span class="va">plot.dat.ppd</span><span class="op">[</span><span class="va">ii</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">realized.SMBC.array</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">jj</span><span class="op">]</span>
      <span class="va">plot.dat.ppd</span><span class="op">[</span><span class="va">ii</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">postpred.SMBC.array</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">jj</span><span class="op">]</span>
      <span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">ii</span> <span class="op">+</span> <span class="fl">1</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="va">plot.dat.ppd</span> <span class="op">&lt;-</span> <span class="va">plot.dat.ppd</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">itemj</span> <span class="op">&lt;</span> <span class="va">itemjj</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"cov("</span>, <span class="va">itemj</span>, <span class="st">", "</span>, <span class="va">itemjj</span>,<span class="st">")"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.dat.ppd</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">real</span>, y<span class="op">=</span><span class="va">ppd</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density2d</span><span class="op">(</span>adjust<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">cov</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-jags-ppd-4.png" width="90%" height="90%"></div>
<!-- ## LSAT Example - OpenBUGS -->
<!-- ```{r chp11-lsat-openbugs, warnings=T, message=T, error=T, cache=TRUE} -->
<!-- # model code -->
<!-- model.file <- paste0(w.d,"/code/IRT-for-Dichotomous-Observables/WinBUGS/3PNO.bug") -->
<!-- cat(model.file) -->
<!-- # get data file -->
<!-- data.file <- paste0(w.d,"/code/IRT-for-Dichotomous-Observables/WinBUGS/data.txt") -->
<!-- # initial values -->
<!-- start_values <- list( -->
<!--   list("d"=c(1.00, 1.00, 1.00, 1.00, 1.00), -->
<!--        "a"=c(1.00, 1.00, 1.00, 1.00, 1.00), -->
<!--        "c"=c(0.20, 0.20, 0.20, 0.20, 0.20)), -->
<!--   list("d"=c(-3.00, -3.00, -3.00, -3.00, -3.00), -->
<!--        "a"=c(3.00, 3.00, 3.00, 3.00, 3.00), -->
<!--        "c"=c(0.50, 0.50, 0.50, 0.50, 0.50)), -->
<!--   list("d"=c(3.00, 3.00, 3.00, 3.00, 3.00), -->
<!--        "a"=c(0.1, 0.1, 0.1, 0.1, 0.1), -->
<!--        "c"=c(0.05, 0.05, 0.05, 0.05, 0.05)) -->
<!-- ) -->
<!-- # vector of all parameters to save -->
<!-- param_save <- c("a", "c", "d", "theta") -->
<!-- # fit model -->
<!-- fit <- openbugs( -->
<!--   data= data.file,  -->
<!--   model.file = model.file, # R grabs the file and runs it in openBUGS -->
<!--   parameters.to.save = param_save, -->
<!--   #inits=start_values, -->
<!--   n.chains = 1, -->
<!--   n.iter = 2000, -->
<!--   n.burnin = 1000 -->
<!-- ) -->
<!-- print(fit) -->
<!-- ``` -->
</div>
</div>
<div id="lsat-example---stan" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> LSAT Example - Stan<a class="anchor" aria-label="anchor" href="#lsat-example---stan"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_irt_lsat</span> <span class="op">&lt;-</span> <span class="st">'
data {
  int  N;
  int  J;
  int x[N,J];
}

parameters {
  real&lt;lower=0&gt; a[J]; //discrimination
  real d[J]; //location
  real&lt;lower=0, upper=1&gt; c[J]; //guessing
  real theta[N]; //person parameters
}

model {
  matrix[N,J] pi;
  // item response probabilities
  for(n in 1:N){
    for(j in 1:J){
      pi[n,j] = c[j]+(1-c[j])*Phi(a[j]*theta[n]+d[j]);
      x[n,j] ~ bernoulli(pi[n,j]);
    }
  }
  //measurement model priors
  for(j in 1:J){
    a[j] ~ normal(1,2)T[0,];
    d[j] ~ normal(0,2);
    c[j] ~ beta(5, 17);
  }
  theta ~ normal(0,1);
}

'</span>


<span class="co"># initial values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span>,
       <span class="st">"c"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span>, <span class="fl">0.20</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"c"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span>, <span class="fl">0.50</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,
       <span class="st">"c"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># dataset</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/LSAT.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>


<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, 
  J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>



<span class="co"># Next, need to fit the model</span>
<span class="co">#   I have explicitly outlined some common parameters</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan</span><span class="op">(</span>
  model_code <span class="op">=</span> <span class="va">model_irt_lsat</span>, <span class="co"># model code to be compiled</span>
  data <span class="op">=</span> <span class="va">mydata</span>,          <span class="co"># my data</span>
  init <span class="op">=</span> <span class="va">start_values</span>,    <span class="co"># starting values</span>
  chains <span class="op">=</span> <span class="fl">3</span>,             <span class="co"># number of Markov chains</span>
  warmup <span class="op">=</span> <span class="fl">2000</span>,          <span class="co"># number of warm up iterations per chain</span>
  iter <span class="op">=</span> <span class="fl">4000</span>,            <span class="co"># total number of iterations per chain</span>
  cores <span class="op">=</span> <span class="fl">1</span>,              <span class="co"># number of cores (could use one per chain)</span>
  refresh <span class="op">=</span> <span class="fl">0</span>             <span class="co"># no progress shown</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first get a basic breakdown of the posteriors</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"theta[1000]"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Stan model: anon_model.
## 3 chains, each with iter=4000; warmup=2000; thin=1; 
## post-warmup draws per chain=2000, total post-warmup draws=6000.
## 
##              mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## d[1]         1.42    0.00 0.15  1.16  1.33  1.41  1.50  1.74  1420    1
## d[2]         0.27    0.01 0.27 -0.37  0.20  0.32  0.42  0.56   596    1
## d[3]        -0.76    0.04 0.68 -2.61 -1.07 -0.55 -0.26  0.00   379    1
## d[4]         0.51    0.01 0.20  0.13  0.44  0.54  0.62  0.75   765    1
## d[5]         1.03    0.00 0.12  0.77  0.96  1.04  1.11  1.26  3190    1
## a[1]         0.47    0.01 0.20  0.17  0.34  0.45  0.56  0.93  1078    1
## a[2]         0.63    0.02 0.45  0.27  0.43  0.53  0.67  1.74   342    1
## a[3]         1.60    0.07 1.11  0.43  0.77  1.21  2.14  4.41   266    1
## a[4]         0.51    0.02 0.30  0.23  0.37  0.47  0.57  1.03   408    1
## a[5]         0.43    0.00 0.17  0.16  0.31  0.40  0.51  0.81  1137    1
## c[1]         0.24    0.00 0.09  0.09  0.17  0.23  0.30  0.44 10326    1
## c[2]         0.26    0.00 0.10  0.09  0.18  0.25  0.32  0.49  1230    1
## c[3]         0.28    0.00 0.08  0.12  0.22  0.29  0.34  0.42   652    1
## c[4]         0.25    0.00 0.10  0.09  0.18  0.24  0.31  0.47  2006    1
## c[5]         0.24    0.00 0.09  0.08  0.17  0.23  0.30  0.44  6963    1
## theta[1000]  0.71    0.01 0.86 -1.04  0.14  0.73  1.30  2.35 12907    1
## 
## Samples were drawn using NUTS(diag_e) at Sun Jul 17 16:25:35 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior in a</span>
<span class="co">#  95% probability interval</span>
<span class="co">#  and 80% to contrast the dispersion</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"theta[1000]"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## ci_level: 0.8 (80% intervals)</code></pre>
<pre><code>## outer_level: 0.95 (95% intervals)</code></pre>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># traceplots</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"theta[1000]"</span><span class="op">)</span>, inc_warmup <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Gelman-Rubin-Brooks Convergence Criterion</span>
<span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-4.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-5.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="st">"theta[1000]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in max(D$Iteration): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Error in ggs_grb(ggs(fit, family = "theta[1000]")): At least two chains are required</code></pre>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># autocorrelation</span>
<span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"d"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-6.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"a"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-7.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-8.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"theta[1000]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in max(D$Iteration): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Error in sprintf("nLags=%d is larger than number of iterations, computing until max possible lag %d", : invalid format '%d'; use format %f, %e, %g or %a for numeric objects</code></pre>
<div class="sourceCode" id="cb333"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior density</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-9.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-10.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"c["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-11.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"theta[1000]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lsat-stan-12.png" width="90%" height="90%"></div>
</div>
<div id="irt-models-for-polytomous-data" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> IRT Models for Polytomous Data<a class="anchor" aria-label="anchor" href="#irt-models-for-polytomous-data"><i class="fas fa-link"></i></a>
</h2>
<p>A commonly used IRT model for polytomous items is the graded response model (GRM).
Below is one way of describing the model.
Let <span class="math inline">\(x_{ij}\)</span> be the observed response to item <span class="math inline">\(j\)</span> from examinee <span class="math inline">\(i\)</span> that may take on values 1, 2, …, <span class="math inline">\(K_j\)</span>, where <span class="math inline">\(K_j\)</span> is the number of possible responses/outcomes for item <span class="math inline">\(j\)</span>.
In many applications, the number of response options is constant across items, though this need not be the case.
The GRM using conditional probability statements about the probability of a response being at or above a specific category and obtaining the probability for each category as a difference of two such conditional probabilities.
That is
<span class="math display">\[P(x_{ij} = k \mid \theta_i, \boldsymbol{d}_j,a_j) = P(x_{ij} \geq k \mid \theta_i, d_{jk},a_j) - P(x_{ij} \geq k+1 \mid \theta_i, d_{j(k+1)},a_j),\]</span>
where <span class="math inline">\(\boldsymbol{d}_j\)</span> is the collection of location/threshold parameters for item <span class="math inline">\(j\)</span>.
The GRM takes on a structure similar to the 2-PL for any one category
<span class="math display">\[P(x_{ij} \geq k \mid \theta_i, d_{jk},a_j)=F(a_j\theta_i + d_{jk}).\]</span></p>
<p>The conditional probability of observed responses may be modeled similarly as we have used for dichotomous responses but with a few important differences.
The conditional distribution of the data is
<span class="math display">\[p(\boldsymbol{x}\mid \boldsymbol{\theta},\boldsymbol{\omega}) = \prod_{i=1}^np(\boldsymbol{x}_i\mid \theta_i, \boldsymbol{\omega}) = \prod_{i=1}^n\prod_{j=1}^Jp(x_{ij}\mid \theta_i, \boldsymbol{\omega}_j),\]</span>
where each <span class="math inline">\(x_{ij}\)</span> is specified as a categorical random variable (or multinomial).
A categorical random variable is a generalization of the Bernoulli distribution which is defined be the collection of category response probabilities
<span class="math display">\[x_{ij} \sim \mathrm{Categorical}(\boldsymbol{P}(x_{ij}\mid\theta_i, \boldsymbol{\omega}_j)).\]</span></p>
<p>The above helps form the likelihood of the observed data.
Next, the prior distribution is described because what the structure should be is not necessarily obvious.</p>
<p>First, the prior for the latent ability follows the same logic from the dichotomous model.
We employ an exchangeability assumption to specify independent priors for each respondent with a normally distribution prior.</p>
<p>Next, the measurement model parameters’ priors are described.
We again can assume exchangeability and arrive at a common but independent prior across items, and assume that the priors for the location and discrimination parameters are independent.
These assumptions may not be tenable in theory, but they are practically useful.
The priors for discrimination stay the same as the dichotomous model.
The priors for the location parameters are a bit more involved.</p>
<p>For the location parameters, the first location parameter <span class="math inline">\(d_{j1}\)</span> specifies the probability of responding a 1 or greater which is a certainty if they gave a response.
Therefore, the probability would be 1.
We set <span class="math inline">\(d_{j1} = -\inf\)</span> and then set a normal prior for <span class="math inline">\(d_{j2}\sim \mathrm{Normal}(\mu_{d2},\sigma^2_{d2})\)</span>.
The priors for the remaining location parameters (<span class="math inline">\(d_{3}-d_{k}\)</span>) can be specified as truncated normal distributions.
That is, the location of the next threshold is constrained to be larger than the previous threshold and is formally
<span class="math display">\[d_{jk} \sim \mathrm{Normal}^{&gt;d_{j(k-1)}}(\mu_{d_k},\sigma^2_{d_k}),\ \mathrm{for}\ k=3, ...,K_j.\]</span></p>
<p>The posterior distribution for the GRM can be parameterized as follows.
The model as described below is very general and can accommodate varying number of thresholds per item but is constrained to only 1 latent factor.</p>
<p><span class="math display">\[p(\boldsymbol{\theta}, \boldsymbol{d}, \boldsymbol{a}\mid \mathbf{x}) \propto \prod_{i=1}^n\prod_{j=1}^Jp(\theta_i\mid\theta_i, \boldsymbol{d}_j, a_j)p(\theta_i)p(a_j)\prod_{k=2}^{K_j}p(d_{jk}),\]</span>
where
<span class="math display">\[\begin{align*}
x_{ij}\mid\theta_i\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;\sim \mathrm{Categorical}(\boldsymbol{P}(x_{ij}\mid\theta_i, \boldsymbol{\omega}_j)),\ \mathrm{for}\ i=1, \cdots, n,\ j = 1, \cdots, J;\\
\mathbf{P}(x_{ij}\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;= \left(P(x_{ij}=1\mid\theta_i, \boldsymbol{d}_j, a_j), \cdots, P(x_{ij}=K_j\mid\theta_i, \boldsymbol{d}_j, a_j)\right),\ \mathrm{for}\ i=1, \cdots, n,\ j = 1, \cdots, J;\\
P(x_{ij}=k\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;= P(x_{ij}\geq k\mid\theta_i,d_{jk}, a_j) - P(x_{ij}\geq k+1\mid\theta_i, d_{j(k+1)}, a_j),\ \mathrm{for}\ i=1, \cdots, n,\ j = 1, \cdots, J,\ k = 1,\cdots,K_j-1;\\
P(x_{ij}=K_j\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;= P(x_{ij}\geq K_j\mid\theta_i,d_{jK_j}, a_j),\ \mathrm{for}\ i=1, \cdots, n,\ j = 1, \cdots, J;\\
P(x_{ij}\geq k\mid\theta_i, d_{jk}, a_j) &amp;= F(a_j\theta_j + d_{jk}),\ \mathrm{for}\ i=1, \cdots, n,\ j = 1, \cdots, J,\ k=2,\cdots,K_j;\\
P(x_{ij}\geq 1\mid\theta_i, d_{j1}, a_j) &amp;= 1,\ \mathrm{for}\ i=1, \cdots, n,\ j = 1, \cdots, J;\\
\theta_i \mid \mu_{\theta}, \sigma^2_{\theta} &amp;\sim \mathrm{Normal}(\mu_{\theta}, \sigma^2_{\theta}),\ \mathrm{for}\ i = 1, \cdots, n;\\
a_j \mid \mu_{a}, \sigma^2_{a} &amp;\sim \mathrm{Normal}^{+}(\mu_{a}, \sigma^2_{a}),\ \mathrm{for}\ j=1, \cdots, J;\\
d_{j2}\mid\mu_{j2}, \sigma^2_{j2} &amp;\sim \mathrm{Normal}(\mu_{j2}, \sigma^2_{j2} ),\ \mathrm{for}\ j=1, \cdots, J;\ \mathrm{and}\\
d_{jk}\mid\mu_{d_{jk}},\sigma^2_{d_{jk}} &amp;\sim \mathrm{Normal}^{&gt;d_{j(k-1)}}(\mu_{d_{jk}},\sigma^2_{d_{jk}}),\ \mathrm{for}\ j=1, \cdots, J,\ k=3, ...,K_j.
\end{align*}\]</span></p>
</div>
<div id="grm-peer-interactions-example" class="section level2" number="11.6">
<h2>
<span class="header-section-number">11.6</span> GRM Peer Interactions Example<a class="anchor" aria-label="anchor" href="#grm-peer-interactions-example"><i class="fas fa-link"></i></a>
</h2>
<p>The book uses an example of Peer Interactions from 500 responses to seven items. All the responses are coded from 1 to 5 on an agreement Likert-type scale.
A DAG for the GRM corresponding to these data is shown below.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp11-dag-2"></span>
<img src="dag/chp11-grm.png" alt="DAG for the for Peer Interactions GRM analysis" width="90%" height="90%"><p class="caption">
Figure 11.4: DAG for the for Peer Interactions GRM analysis
</p>
</div>
<p>The path diagram version is substantially simpler and identical to the path diagram for the 3-PL and factor analysis diagrams.
Highlighting the similarity in <em>substantive</em> modeling of polytomous items to dichotomous items.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp11-pathdiag-2"></span>
<img src="path-diagram/chp11-grm.png" alt="Path diagram for the Peer Interactions GRM analysis" width="90%" height="90%"><p class="caption">
Figure 11.5: Path diagram for the Peer Interactions GRM analysis
</p>
</div>
<p>For completeness, I have included the model specification diagram that more concretely connects the DAG and path diagram to the assumed distributions and priors.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp11-spec-2"></span>
<img src="model-spec/chp11-grm.png" alt="Model specification diagram for the Peer Interactions GRM analysis" width="90%" height="90%"><p class="caption">
Figure 11.6: Model specification diagram for the Peer Interactions GRM analysis
</p>
</div>
<div id="example-specific-model-specification" class="section level3" number="11.6.1">
<h3>
<span class="header-section-number">11.6.1</span> Example Specific Model Specification<a class="anchor" aria-label="anchor" href="#example-specific-model-specification"><i class="fas fa-link"></i></a>
</h3>
<p>In fitting the GRM to the Peer Interactions data, we can be more precise about the prior and likelihood structure.
Below is a breakdown of the model specific to this example.
Everything is structurally identical to the previous page but specific values are chosen for the hyperparameters.</p>
<p><span class="math display">\[p(\boldsymbol{\theta}, \boldsymbol{d}, \boldsymbol{a}\mid \mathbf{x}) \propto \prod_{i=1}^n\prod_{j=1}^Jp(\theta_i\mid\theta_i, \boldsymbol{d}_j, a_j)p(\theta_i)p(a_j)\prod_{k=2}^{K_j}p(d_{jk}),\]</span>
where
<span class="math display">\[\begin{align*}
x_{ij}\mid\theta_i\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;\sim \mathrm{Categorical}(\boldsymbol{P}(x_{ij}\mid\theta_i, \boldsymbol{\omega}_j)),\ \mathrm{for}\ i=1, \cdots, 500,\ j = 1, \cdots, 7;\\
\mathbf{P}(x_{ij}\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;= \left(P(x_{ij}=1\mid\theta_i, \boldsymbol{d}_j, a_j), \cdots, P(x_{ij}=5\mid\theta_i, \boldsymbol{d}_j, a_j)\right),\ \mathrm{for}\ i=1, \cdots, 500,\ j = 1, \cdots, 7;\\
P(x_{ij}=k\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;= P(x_{ij}\geq k\mid\theta_i,d_{jk}, a_j) - P(x_{ij}\geq k+1\mid\theta_i, d_{j(k+1)}, a_j),\ \mathrm{for}\ i=1, \cdots, 500,\ j = 1, \cdots, 7,\ k = 1,\cdots,4;\\
P(x_{ij}=5\mid\theta_i, \boldsymbol{d}_j, a_j) &amp;= P(x_{ij}\geq 5\mid\theta_i,d_{j5}, a_j),\ \mathrm{for}\ i=1, \cdots, 500,\ j = 1, \cdots, 7;\\
P(x_{ij}\geq k\mid\theta_i, d_{jk}, a_j) &amp;= F(a_j\theta_j + d_{jk}) = \frac{\exp\left(a_j\theta_i +d_{jk}\right)}{1+\exp\left(a_j\theta_i +d_{jk}\right)},\ \mathrm{for}\ i=1, \cdots, 500,\ j = 1, \cdots, 7,\ k=2,\cdots,5;\\
P(x_{ij}\geq 1\mid\theta_i, d_{j1}, a_j) &amp;= 1,\ \mathrm{for}\ i=1, \cdots, 500,\ j = 1, \cdots, 7;\\
\theta_i \mid \mu_{\theta}, \sigma^2_{\theta} &amp;\sim \mathrm{Normal}(0, 1),\ \mathrm{for}\ i = 1, \cdots, 500;\\
a_j \mid \mu_{a}, \sigma^2_{a} &amp;\sim \mathrm{Normal}^{+}(0,2),\ \mathrm{for}\ j=1, \cdots, 7;\\
d_{j2}\mid\mu_{d_{j2}}, \sigma^2_{d_{j2}} &amp;\sim \mathrm{Normal}(2,2),\ \mathrm{for}\ j=1, \cdots, 7;\\
d_{j3}\mid\mu_{d_{j3}},\sigma^2_{d_{j3}} &amp;\sim \mathrm{Normal}^{&gt;d_{j2}}(1, 2),\ \mathrm{for}\ j=1, \cdots, 7;\\
d_{j4}\mid\mu_{d_{j4}},\sigma^2_{d_{j4}} &amp;\sim \mathrm{Normal}^{&gt;d_{j3}}(-1, 2),\ \mathrm{for}\ j=1, \cdots, 7; \mathrm{and}\\
d_{j5}\mid\mu_{d_{j5}},\sigma^2_{d_{j5}} &amp;\sim \mathrm{Normal}^{&gt;d_{j4}}(-2, 2),\ \mathrm{for}\ j=1, \cdots, 7.
\end{align*}\]</span></p>
</div>
</div>
<div id="pi-example---jags" class="section level2" number="11.7">
<h2>
<span class="header-section-number">11.7</span> PI Example - JAGS<a class="anchor" aria-label="anchor" href="#pi-example---jags"><i class="fas fa-link"></i></a>
</h2>
<p>In the below implementation, I had to change <code>d[j,3] ~ dnorm(1, .5)I(d[j,4],d[j,2])</code> to <code>d[j,3] ~ dnorm(1, .5);I(,d[j,2])</code> because (1) R is dumb and doesn’t realize that <code>I</code> is a JAGS function; and (2) JAGS does not allow for a <code>directed cycle</code>.
The directed cycle in the DAG is when the range of values for <code>d[j,3]</code> is fixed to be within <code>I(d[j,4],d[j,2])</code> and is not permissible. We need to simply constrain the thresholds to be decreasing or smaller than the previous threshold.
I’m not sure of the underlying technical reason for this error, but I found that adding the semi-colon fixes the issue when defining the model as an R function.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jags.model.peer.int</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>

  <span class="co">#######################################</span>
  <span class="co"># Specify the item response measurement model for the observables</span>
  <span class="co">#######################################</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
  
      <span class="co">###################################</span>
      <span class="co"># Specify the probabilities of a value being greater than or equal to each category</span>
      <span class="co">###################################</span>
      <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
        <span class="co"># P(greater than or equal to category k &gt; 1)</span>
        <span class="fu">logit</span><span class="op">(</span><span class="va">P.gte</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">*</span><span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="va">k</span><span class="op">]</span>
      <span class="op">}</span>
      <span class="co"># P(greater than or equal to category 1)</span>
      <span class="va">P.gte</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  
  
      <span class="co">###################################</span>
      <span class="co"># Specify the probabilities of a value being equal to each category</span>
      <span class="co">###################################</span>
      <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
        <span class="co"># P(greater equal to category k &lt; K)</span>
        <span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">P.gte</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">]</span><span class="op">-</span><span class="va">P.gte</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">k</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>
      <span class="op">}</span>
      <span class="co"># P(greater equal to category K)</span>
      <span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">K</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">P.gte</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="va">K</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>
      
      <span class="co">###################################</span>
      <span class="co"># Specify the distribution for each observable</span>
      <span class="co">###################################</span>
      <span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu">dcat</span><span class="op">(</span><span class="va">P</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span>,<span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  
  <span class="co">#######################################</span>
  <span class="co"># Specify the (prior) distribution for the latent variables</span>
  <span class="co">#######################################</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
    <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># distribution for the latent variables</span>
  <span class="op">}</span>
  
  
  <span class="co">#######################################</span>
  <span class="co"># Specify the prior distribution for the measurement model parameters</span>
  <span class="co">#######################################</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    
    <span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">.5</span><span class="op">)</span>                   <span class="co"># Locations for k = 2</span>
    <span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span>,<span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>   <span class="co"># Locations for k = 3</span>
    <span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span>,<span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Locations for k = 4</span>
    <span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">.5</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span>,<span class="va">d</span><span class="op">[</span><span class="va">j</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span>        <span class="co"># Locations for k = 5</span>
    <span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">)</span>    <span class="co"># Discriminations for observables</span>
  
  <span class="op">}</span>

<span class="op">}</span> <span class="co"># closes the model</span>

<span class="co"># initial values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    d<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">3.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">3.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">3.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">3.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">3.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">3.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span><span class="op">)</span>,
      ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">7</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    d<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span><span class="op">)</span>,
      ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">7</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    d<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="op">-</span><span class="fl">3.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="op">-</span><span class="fl">3.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="op">-</span><span class="fl">3.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="op">-</span><span class="fl">3.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="op">-</span><span class="fl">3.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="op">-</span><span class="fl">3.00E+00</span>,
               <span class="cn">NA</span>, <span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="op">-</span><span class="fl">3.00E+00</span><span class="op">)</span>,
              ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">7</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"theta"</span><span class="op">)</span>

<span class="co"># dataset</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/PI.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>
  model.file<span class="op">=</span><span class="va">jags.model.peer.int</span>,
  data<span class="op">=</span><span class="va">mydata</span>,
  inits<span class="op">=</span><span class="va">start_values</span>,
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  n.iter<span class="op">=</span><span class="fl">2000</span>,
  n.burnin <span class="op">=</span> <span class="fl">1000</span>,
  n.chains <span class="op">=</span> <span class="fl">3</span>,
  progress.bar <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 3500
##    Unobserved stochastic nodes: 535
##    Total graph size: 53050
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Bugs model at "C:/Users/noahp/AppData/Local/Temp/RtmpMh7bvq/model3bcc64b92e59.txt", fit using jags,
##  3 chains, each with 2000 iterations (first 1000 discarded)
##  n.sims = 3000 iterations saved
##             mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat n.eff
## a[1]          2.136   0.164    1.845    2.024    2.126    2.239    2.481 1.006   670
## a[2]          3.521   0.260    3.016    3.346    3.518    3.696    4.032 1.008   270
## a[3]          3.957   0.303    3.356    3.758    3.959    4.149    4.550 1.004   530
## a[4]          3.576   0.252    3.104    3.401    3.571    3.747    4.088 1.008   260
## a[5]          2.444   0.171    2.124    2.323    2.437    2.563    2.786 1.009   270
## a[6]          1.866   0.151    1.587    1.761    1.861    1.965    2.171 1.011   200
## a[7]          1.495   0.121    1.255    1.413    1.492    1.577    1.730 1.004  2300
## d[1,2]        4.952   0.328    4.343    4.735    4.949    5.156    5.639 1.002  1000
## d[2,2]        5.185   0.355    4.529    4.936    5.169    5.420    5.915 1.007   330
## d[3,2]        6.513   0.482    5.575    6.188    6.506    6.830    7.485 1.003  1400
## d[4,2]        6.385   0.435    5.593    6.086    6.373    6.676    7.251 1.004   650
## d[5,2]        4.768   0.312    4.184    4.562    4.759    4.973    5.403 1.013   200
## d[6,2]        3.833   0.258    3.362    3.653    3.825    4.007    4.361 1.013   160
## d[7,2]        4.274   0.286    3.723    4.080    4.265    4.460    4.852 1.001  2400
## d[1,3]        2.943   0.211    2.536    2.800    2.939    3.085    3.370 1.003   970
## d[2,3]        1.169   0.201    0.756    1.046    1.174    1.300    1.563 1.020   240
## d[3,3]        3.323   0.296    2.753    3.120    3.329    3.508    3.930 1.002  2300
## d[4,3]        2.703   0.242    2.261    2.536    2.695    2.859    3.194 1.009   270
## d[5,3]        2.672   0.203    2.268    2.540    2.676    2.805    3.073 1.013   200
## d[6,3]        1.949   0.164    1.626    1.837    1.951    2.059    2.275 1.012   200
## d[7,3]        2.443   0.167    2.120    2.330    2.446    2.557    2.762 1.004   710
## d[1,4]        0.645   0.146    0.362    0.547    0.644    0.741    0.934 1.006   360
## d[2,4]       -1.785   0.222   -2.239   -1.929   -1.780   -1.627   -1.370 1.020   110
## d[3,4]       -1.325   0.233   -1.837   -1.467   -1.312   -1.164   -0.903 1.024    90
## d[4,4]       -0.806   0.206   -1.253   -0.933   -0.797   -0.672   -0.425 1.019   160
## d[5,4]       -0.356   0.156   -0.670   -0.455   -0.353   -0.249   -0.059 1.011   190
## d[6,4]       -0.490   0.131   -0.767   -0.571   -0.488   -0.403   -0.240 1.007   650
## d[7,4]        0.263   0.116    0.038    0.186    0.266    0.341    0.482 1.008   290
## d[1,5]       -2.511   0.186   -2.887   -2.636   -2.507   -2.379   -2.157 1.007   320
## d[2,5]       -5.140   0.368   -5.858   -5.374   -5.137   -4.885   -4.446 1.011   200
## d[3,5]       -5.562   0.419   -6.453   -5.830   -5.553   -5.272   -4.757 1.013   170
## d[4,5]       -4.855   0.348   -5.562   -5.083   -4.832   -4.625   -4.196 1.017   220
## d[5,5]       -3.605   0.243   -4.092   -3.762   -3.600   -3.436   -3.153 1.003  3000
## d[6,5]       -3.210   0.214   -3.631   -3.355   -3.205   -3.061   -2.806 1.009   530
## d[7,5]       -2.748   0.179   -3.112   -2.865   -2.740   -2.625   -2.413 1.004   650
## theta[1]      0.855   0.285    0.283    0.669    0.853    1.050    1.390 1.001  3000
## theta[2]     -0.976   0.268   -1.499   -1.152   -0.970   -0.802   -0.457 1.002  1000
## theta[3]     -1.040   0.252   -1.546   -1.205   -1.041   -0.871   -0.539 1.002  1100
## theta[4]     -0.257   0.258   -0.769   -0.428   -0.252   -0.083    0.242 1.001  3000
## theta[5]      0.113   0.274   -0.412   -0.070    0.124    0.293    0.636 1.001  3000
## theta[6]      0.107   0.248   -0.364   -0.062    0.107    0.272    0.598 1.004   570
## theta[7]      1.470   0.330    0.861    1.244    1.456    1.683    2.147 1.005   600
## theta[8]      0.787   0.258    0.292    0.608    0.788    0.964    1.297 1.001  3000
## theta[9]      0.004   0.253   -0.495   -0.166    0.008    0.173    0.503 1.004   580
## theta[10]     0.371   0.267   -0.130    0.194    0.367    0.543    0.896 1.001  3000
## theta[11]    -0.758   0.259   -1.266   -0.938   -0.754   -0.585   -0.231 1.001  2100
## theta[12]    -0.195   0.253   -0.697   -0.365   -0.194   -0.028    0.300 1.003   830
## theta[13]     1.036   0.267    0.521    0.857    1.036    1.210    1.562 1.003   720
## theta[14]     0.006   0.261   -0.516   -0.164    0.009    0.183    0.520 1.002  1600
## theta[15]    -0.698   0.267   -1.219   -0.880   -0.704   -0.518   -0.176 1.003   810
## theta[16]    -0.449   0.292   -1.001   -0.654   -0.451   -0.253    0.124 1.001  3000
## theta[17]     2.349   0.463    1.582    2.021    2.299    2.619    3.407 1.001  3000
## theta[18]     0.232   0.260   -0.271    0.062    0.236    0.404    0.744 1.002  2000
## theta[19]     0.045   0.260   -0.457   -0.133    0.046    0.216    0.564 1.001  3000
## theta[20]     0.240   0.263   -0.282    0.069    0.242    0.415    0.749 1.002  1300
## theta[21]     0.370   0.259   -0.139    0.198    0.370    0.543    0.883 1.001  3000
## theta[22]    -1.004   0.267   -1.518   -1.189   -1.003   -0.829   -0.479 1.001  2500
## theta[23]     0.698   0.265    0.195    0.520    0.699    0.869    1.231 1.003   900
## theta[24]     0.059   0.263   -0.468   -0.116    0.060    0.237    0.562 1.002  3000
## theta[25]     2.356   0.452    1.589    2.028    2.316    2.637    3.354 1.002  2900
## theta[26]     0.549   0.303   -0.038    0.342    0.539    0.758    1.137 1.001  3000
## theta[27]    -0.753   0.269   -1.275   -0.924   -0.759   -0.581   -0.192 1.002  1300
## theta[28]     0.214   0.260   -0.298    0.044    0.217    0.392    0.728 1.004   600
## theta[29]     1.074   0.290    0.525    0.876    1.063    1.267    1.662 1.003  3000
## theta[30]     0.373   0.263   -0.146    0.201    0.371    0.547    0.890 1.001  3000
## theta[31]     0.489   0.258   -0.019    0.311    0.484    0.659    1.002 1.002  1800
## theta[32]     0.438   0.261   -0.069    0.261    0.437    0.608    0.958 1.001  3000
## theta[33]     0.439   0.268   -0.102    0.256    0.441    0.617    0.973 1.001  3000
## theta[34]     0.137   0.261   -0.377   -0.037    0.141    0.309    0.652 1.002  3000
## theta[35]    -1.317   0.268   -1.848   -1.494   -1.319   -1.143   -0.770 1.003   890
## theta[36]     0.783   0.256    0.282    0.615    0.779    0.956    1.284 1.005   430
## theta[37]    -0.516   0.260   -1.010   -0.694   -0.524   -0.347    0.022 1.004   610
## theta[38]    -0.727   0.250   -1.222   -0.887   -0.725   -0.562   -0.240 1.002  1900
## theta[39]    -0.461   0.296   -1.048   -0.659   -0.460   -0.262    0.124 1.004  1400
## theta[40]    -0.128   0.272   -0.669   -0.310   -0.123    0.058    0.392 1.006   370
## theta[41]     0.228   0.278   -0.308    0.041    0.231    0.411    0.784 1.001  3000
## theta[42]    -2.225   0.354   -2.982   -2.452   -2.204   -1.975   -1.596 1.001  3000
## theta[43]     2.103   0.389    1.447    1.833    2.075    2.338    3.007 1.001  3000
## theta[44]    -0.396   0.303   -0.988   -0.606   -0.389   -0.195    0.189 1.001  3000
## theta[45]     2.361   0.481    1.556    2.028    2.303    2.647    3.514 1.001  3000
## theta[46]     0.796   0.262    0.281    0.625    0.790    0.966    1.331 1.001  3000
## theta[47]    -0.845   0.274   -1.381   -1.032   -0.841   -0.664   -0.312 1.002  1200
## theta[48]    -0.168   0.266   -0.701   -0.340   -0.160    0.015    0.322 1.002  2100
## theta[49]     0.178   0.270   -0.339    0.006    0.171    0.353    0.719 1.002  1100
## theta[50]    -0.582   0.285   -1.128   -0.775   -0.589   -0.389   -0.028 1.001  3000
## theta[51]    -0.377   0.262   -0.900   -0.554   -0.374   -0.199    0.130 1.005   440
## theta[52]    -0.998   0.260   -1.508   -1.177   -1.005   -0.828   -0.476 1.001  3000
## theta[53]     0.444   0.266   -0.082    0.266    0.446    0.628    0.951 1.001  3000
## theta[54]     0.380   0.272   -0.164    0.203    0.378    0.559    0.916 1.002  1900
## theta[55]    -0.829   0.271   -1.362   -1.010   -0.826   -0.651   -0.308 1.001  3000
## theta[56]     0.782   0.262    0.276    0.607    0.781    0.958    1.292 1.003   870
## theta[57]     1.393   0.275    0.852    1.207    1.389    1.568    1.954 1.001  3000
## theta[58]    -0.840   0.243   -1.302   -1.017   -0.845   -0.669   -0.371 1.001  2500
## theta[59]     0.111   0.253   -0.381   -0.052    0.108    0.279    0.617 1.007   310
## theta[60]     0.357   0.261   -0.156    0.183    0.355    0.530    0.878 1.003  1300
## theta[61]    -1.806   0.316   -2.490   -2.013   -1.792   -1.589   -1.235 1.001  3000
## theta[62]    -0.416   0.257   -0.905   -0.588   -0.419   -0.249    0.113 1.002  1000
## theta[63]     2.365   0.489    1.533    2.018    2.312    2.674    3.411 1.003   770
## theta[64]    -0.926   0.254   -1.434   -1.097   -0.921   -0.748   -0.444 1.001  3000
## theta[65]     0.387   0.264   -0.119    0.206    0.382    0.562    0.918 1.002  1800
## theta[66]     0.777   0.253    0.279    0.606    0.773    0.946    1.281 1.029   720
## theta[67]     0.344   0.250   -0.146    0.179    0.339    0.505    0.848 1.001  3000
## theta[68]     1.622   0.285    1.076    1.433    1.614    1.807    2.207 1.006   550
## theta[69]     1.091   0.268    0.554    0.912    1.089    1.272    1.618 1.003   960
## theta[70]     1.622   0.297    1.066    1.421    1.611    1.810    2.259 1.001  2000
## theta[71]    -0.003   0.247   -0.493   -0.178    0.002    0.169    0.478 1.002  1600
## theta[72]    -1.028   0.254   -1.538   -1.193   -1.029   -0.853   -0.564 1.001  3000
## theta[73]     0.158   0.259   -0.359   -0.010    0.161    0.332    0.663 1.001  3000
## theta[74]    -2.300   0.384   -3.130   -2.533   -2.272   -2.035   -1.665 1.004  3000
## theta[75]    -0.108   0.284   -0.659   -0.297   -0.106    0.082    0.448 1.001  2300
## theta[76]    -1.098   0.254   -1.596   -1.268   -1.094   -0.928   -0.609 1.003   870
##  [ reached getOption("max.print") -- omitted 425 rows ]
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 692.5 and DIC = 7012.1
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span> <span class="op">%like%</span> <span class="st">"theta"</span>, <span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>##              mean     sd     2.5%      25%      50%      75%    97.5%  Rhat n.eff
## a[1]        2.136  0.164    1.845    2.024    2.126    2.239    2.481 1.006   670
## a[2]        3.521  0.260    3.016    3.346    3.518    3.696    4.032 1.008   270
## a[3]        3.957  0.303    3.356    3.758    3.959    4.149    4.550 1.004   530
## a[4]        3.576  0.252    3.104    3.401    3.571    3.747    4.088 1.008   260
## a[5]        2.444  0.171    2.124    2.323    2.437    2.563    2.786 1.009   270
## a[6]        1.866  0.151    1.587    1.761    1.861    1.965    2.171 1.011   200
## a[7]        1.495  0.121    1.255    1.413    1.492    1.577    1.730 1.004  2300
## d[1,2]      4.952  0.328    4.343    4.735    4.949    5.156    5.639 1.002  1000
## d[2,2]      5.185  0.355    4.529    4.936    5.169    5.420    5.915 1.007   330
## d[3,2]      6.513  0.482    5.575    6.188    6.506    6.830    7.485 1.003  1400
## d[4,2]      6.385  0.435    5.593    6.086    6.373    6.676    7.251 1.004   650
## d[5,2]      4.768  0.312    4.184    4.562    4.759    4.973    5.403 1.013   200
## d[6,2]      3.833  0.258    3.362    3.653    3.825    4.007    4.361 1.013   160
## d[7,2]      4.274  0.286    3.723    4.080    4.265    4.460    4.852 1.001  2400
## d[1,3]      2.943  0.211    2.536    2.800    2.939    3.085    3.370 1.003   970
## d[2,3]      1.169  0.201    0.756    1.046    1.174    1.300    1.563 1.020   240
## d[3,3]      3.323  0.296    2.753    3.120    3.329    3.508    3.930 1.002  2300
## d[4,3]      2.703  0.242    2.261    2.536    2.695    2.859    3.194 1.009   270
## d[5,3]      2.672  0.203    2.268    2.540    2.676    2.805    3.073 1.013   200
## d[6,3]      1.949  0.164    1.626    1.837    1.951    2.059    2.275 1.012   200
## d[7,3]      2.443  0.167    2.120    2.330    2.446    2.557    2.762 1.004   710
## d[1,4]      0.645  0.146    0.362    0.547    0.644    0.741    0.934 1.006   360
## d[2,4]     -1.785  0.222   -2.239   -1.929   -1.780   -1.627   -1.370 1.020   110
## d[3,4]     -1.325  0.233   -1.837   -1.467   -1.312   -1.164   -0.903 1.024    90
## d[4,4]     -0.806  0.206   -1.253   -0.933   -0.797   -0.672   -0.425 1.019   160
## d[5,4]     -0.356  0.156   -0.670   -0.455   -0.353   -0.249   -0.059 1.011   190
## d[6,4]     -0.490  0.131   -0.767   -0.571   -0.488   -0.403   -0.240 1.007   650
## d[7,4]      0.263  0.116    0.038    0.186    0.266    0.341    0.482 1.008   290
## d[1,5]     -2.511  0.186   -2.887   -2.636   -2.507   -2.379   -2.157 1.007   320
## d[2,5]     -5.140  0.368   -5.858   -5.374   -5.137   -4.885   -4.446 1.011   200
## d[3,5]     -5.562  0.419   -6.453   -5.830   -5.553   -5.272   -4.757 1.013   170
## d[4,5]     -4.855  0.348   -5.562   -5.083   -4.832   -4.625   -4.196 1.017   220
## d[5,5]     -3.605  0.243   -4.092   -3.762   -3.600   -3.436   -3.153 1.003  3000
## d[6,5]     -3.210  0.214   -3.631   -3.355   -3.205   -3.061   -2.806 1.009   530
## d[7,5]     -2.748  0.179   -3.112   -2.865   -2.740   -2.625   -2.413 1.004   650
## deviance 6319.569 37.286 6251.475 6293.382 6318.824 6344.230 6396.701 1.005   460</code></pre>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract posteriors for all chains</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu">as.mcmc</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="co"># convert to single data.frame for density plot</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">jags.mcmc</span>, chains<span class="op">=</span><span class="cn">T</span>, iters <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"chain"</span>, <span class="st">"iter"</span>, <span class="va">a</span><span class="op">)</span>


<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,<span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html">mcmc_areas</a></span><span class="op">(</span><span class="va">plot.data</span>, regex_pars <span class="op">=</span> <span class="st">"d"</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>  <span class="va">plot_title</span> <span class="op">+</span> <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'x' is already present. Adding another scale for 'x', which will replace the existing
## scale.</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_segment).</code></pre>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-jags-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html">mcmc_areas</a></span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-jags-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-diagnostics.html">mcmc_acf</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-jags-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">plot.data</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-jags-4.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_grb.html">ggs_grb</a></span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"d"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-jags-5.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_grb.html">ggs_grb</a></span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"a"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-jags-6.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggmcmc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_autocorrelation.html">ggs_autocorrelation</a></span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"d"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-jags-7.png" width="90%" height="90%"></div>
<!-- ## PI Example - OpenBUGS -->
<!-- I ran into issues using the BUGs code provided in text using JAGS so I figured I would replicate the model using OpenBUGS directly to test whether the model can be run as is without any modifications. -->
<!-- ```{r chp11-peer-int-openbugs, warnings=T, message=T, error=T, cache=TRUE} -->
<!-- # model code -->
<!-- model.file <- paste0(w.d,"/code/IRT-for-Polytomous-Observables/IRT for Polytomous Observables/WinBUGS/L-GRM (Normal with Bounds, Truncated-Normal).bug") -->
<!-- cat(model.file) -->
<!-- # get data file -->
<!-- data.file <- paste0(w.d,"/code/IRT-for-Polytomous-Observables/IRT for Polytomous Observables/WinBUGS/data.txt") -->
<!-- # initial values -->
<!-- start_values <- list( -->
<!--   list( -->
<!--     d= matrix(c(NA, 3.00E+00, 1.00E+00, 0.00E+00, -1.00E+00, -->
<!--                NA, 3.00E+00, 1.00E+00, 0.00E+00, -1.00E+00, -->
<!--                NA, 3.00E+00, 1.00E+00, 0.00E+00, -1.00E+00, -->
<!--                NA, 3.00E+00, 1.00E+00, 0.00E+00, -1.00E+00, -->
<!--                NA, 3.00E+00, 1.00E+00, 0.00E+00, -1.00E+00, -->
<!--                NA, 3.00E+00, 1.00E+00, 0.00E+00, -1.00E+00, -->
<!--                NA, 3.00E+00, 1.00E+00, 0.00E+00, -1.00E+00), -->
<!--       ncol=5, nrow=7, byrow=T), -->
<!--     a=c(1.00E-01, 1.00E-01, 1.00E-01, 1.00E-01, 1.00E-01, 1.00E-01, 1.00E-01)), -->
<!--   list( -->
<!--     d= matrix(c(NA, 2.00E+00, 0.00E+00, -1.00E+00, -2.00E+00, -->
<!--                NA, 2.00E+00, 0.00E+00, -1.00E+00, -2.00E+00, -->
<!--                NA, 2.00E+00, 0.00E+00, -1.00E+00, -2.00E+00, -->
<!--                NA, 2.00E+00, 0.00E+00, -1.00E+00, -2.00E+00, -->
<!--                NA, 2.00E+00, 0.00E+00, -1.00E+00, -2.00E+00, -->
<!--                NA, 2.00E+00, 0.00E+00, -1.00E+00, -2.00E+00, -->
<!--                NA, 2.00E+00, 0.00E+00, -1.00E+00, -2.00E+00), -->
<!--       ncol=5, nrow=7, byrow=T), -->
<!--     a=c(3.00E+00, 3.00E+00, 3.00E+00, 3.00E+00, 3.00E+00, 3.00E+00, 3.00E+00)), -->
<!--   list( -->
<!--     d= matrix(c(NA, 1.00E+00, -1.00E+00, -2.00E+00, -3.00E+00, -->
<!--                NA, 1.00E+00, -1.00E+00, -2.00E+00, -3.00E+00, -->
<!--                NA, 1.00E+00, -1.00E+00, -2.00E+00, -3.00E+00, -->
<!--                NA, 1.00E+00, -1.00E+00, -2.00E+00, -3.00E+00, -->
<!--                NA, 1.00E+00, -1.00E+00, -2.00E+00, -3.00E+00, -->
<!--                NA, 1.00E+00, -1.00E+00, -2.00E+00, -3.00E+00, -->
<!--                NA, 1.00E+00, -1.00E+00, -2.00E+00, -3.00E+00), -->
<!--               ncol=5, nrow=7, byrow=T), -->
<!--     a=c(1.00E+00, 1.00E+00, 1.00E+00, 1.00E+00, 1.00E+00, 1.00E+00, 1.00E+00)) -->
<!-- ) -->
<!-- # vector of all parameters to save -->
<!-- param_save <- c("a", "d", "theta") -->
<!-- # fit model -->
<!-- fit <- openbugs( -->
<!--   data= data.file,  -->
<!--   model.file = model.file, # R grabs the file and runs it in openBUGS -->
<!--   parameters.to.save = param_save, -->
<!--   inits=start_values, -->
<!--   n.chains = 3, -->
<!--   n.iter = 2000, -->
<!--   n.burnin = 1000, -->
<!--   n.thin = 1 -->
<!-- ) -->
<!-- print(fit) -->
<!-- ``` -->
</div>
<div id="pi-example---stan" class="section level2" number="11.8">
<h2>
<span class="header-section-number">11.8</span> PI Example - Stan<a class="anchor" aria-label="anchor" href="#pi-example---stan"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_irt_peer_int</span> <span class="op">&lt;-</span> <span class="st">'
data {
  int  N;
  int  J;
  int  K;
  int  x[N,J];
}

parameters {
  real&lt;lower=0&gt; a[J]; //discrimination
  ordered[K-1] d[J]; //location/thresholds
  real theta[N]; //person parameters
}

model {
  // item response probabilities
  for(n in 1:N){
    for(j in 1:J){
      x[n,j] ~ ordered_logistic(a[j]*theta[n], d[j,1:(K-1)]);
    }
  }
  //measurement model priors
  theta ~ normal(0,1);
  for(j in 1:J){
    a[j] ~ normal(1,2)T[0,];
    d[j,1] ~ normal(-2,2);
    d[j,2] ~ normal(-1,2)T[d[j,1],];
    d[j,3] ~ normal(1,2)T[d[j,2],];
    d[j,4] ~ normal(2,2)T[d[j,3],];
  }
}

'</span>


<span class="co"># initial values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    d<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>,
               <span class="op">-</span><span class="fl">3.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>,
               <span class="op">-</span><span class="fl">3.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>,
               <span class="op">-</span><span class="fl">3.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>,
               <span class="op">-</span><span class="fl">3.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>,
               <span class="op">-</span><span class="fl">3.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>,
               <span class="op">-</span><span class="fl">3.00E+00</span>, <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span><span class="op">)</span>,
      ncol<span class="op">=</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">7</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span>, <span class="fl">1.00E-01</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    d<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>,
               <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>,
               <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>,
               <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>,
               <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>,
               <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>,
               <span class="op">-</span><span class="fl">2.00E+00</span>, <span class="fl">0.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span><span class="op">)</span>,
      ncol<span class="op">=</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">7</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span>, <span class="fl">3.00E+00</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    d<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>, <span class="fl">3.00E+00</span>,
               <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>, <span class="fl">3.00E+00</span>,
               <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>, <span class="fl">3.00E+00</span>,
               <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>, <span class="fl">3.00E+00</span>,
               <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>, <span class="fl">3.00E+00</span>,
               <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>, <span class="fl">3.00E+00</span>,
               <span class="op">-</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">2.00E+00</span>, <span class="fl">3.00E+00</span><span class="op">)</span>,
              ncol<span class="op">=</span><span class="fl">4</span>, nrow<span class="op">=</span><span class="fl">7</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    a<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span>, <span class="fl">1.00E+00</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># dataset</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/PI.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  K <span class="op">=</span> <span class="fl">5</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>


<span class="co"># Next, need to fit the model</span>
<span class="co">#   I have explicitly outlined some common parameters</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan</span><span class="op">(</span>
  model_code <span class="op">=</span> <span class="va">model_irt_peer_int</span>, <span class="co"># model code to be compiled</span>
  data <span class="op">=</span> <span class="va">mydata</span>,          <span class="co"># my data</span>
  <span class="co">#init = start_values,    # starting values</span>
  chains <span class="op">=</span> <span class="fl">1</span>,             <span class="co"># number of Markov chains</span>
  warmup <span class="op">=</span> <span class="fl">1000</span>,          <span class="co"># number of warm up iterations per chain</span>
  iter <span class="op">=</span> <span class="fl">2000</span>,            <span class="co"># total number of iterations per chain</span>
  cores <span class="op">=</span> <span class="fl">1</span>,              <span class="co"># number of cores (could use one per chain)</span>
  <span class="co">#refresh = 0             # no progress shown</span>
<span class="op">)</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 0.003775 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 37.75 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 131.248 seconds (Warm-up)
## Chain 1:                107.288 seconds (Sampling)
## Chain 1:                238.536 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first get a basic breakdown of the posteriors</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"theta[500]"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Stan model: anon_model.
## 1 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=1000.
## 
##             mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## d[1,1]     -5.08    0.01 0.34 -5.75 -5.31 -5.10 -4.84 -4.43   607 1.00
## d[1,2]     -3.04    0.01 0.21 -3.46 -3.17 -3.03 -2.90 -2.65   307 1.00
## d[1,3]     -0.72    0.01 0.15 -1.03 -0.81 -0.71 -0.61 -0.42   171 1.00
## d[1,4]      2.46    0.01 0.19  2.07  2.33  2.46  2.59  2.85   234 1.00
## d[2,1]     -5.53    0.02 0.43 -6.35 -5.82 -5.53 -5.24 -4.69   341 1.01
## d[2,2]     -1.33    0.02 0.24 -1.81 -1.48 -1.34 -1.17 -0.86   169 1.00
## d[2,3]      1.74    0.02 0.25  1.28  1.57  1.73  1.90  2.22   162 1.00
## d[2,4]      5.25    0.02 0.42  4.47  4.97  5.21  5.51  6.14   329 1.00
## d[3,1]     -7.16    0.03 0.57 -8.27 -7.54 -7.15 -6.75 -6.10   279 1.01
## d[3,2]     -3.72    0.03 0.36 -4.45 -3.96 -3.71 -3.46 -3.06   208 1.02
## d[3,3]      1.27    0.02 0.26  0.75  1.10  1.27  1.45  1.78   143 1.00
## d[3,4]      5.86    0.03 0.49  4.96  5.52  5.83  6.16  6.87   242 1.00
## d[4,1]     -6.76    0.03 0.50 -7.78 -7.10 -6.74 -6.39 -5.86   300 1.00
## d[4,2]     -2.91    0.02 0.27 -3.48 -3.08 -2.89 -2.72 -2.44   221 1.00
## d[4,3]      0.71    0.02 0.23  0.29  0.55  0.70  0.87  1.14   146 1.00
## d[4,4]      4.89    0.03 0.38  4.21  4.62  4.89  5.14  5.66   220 1.00
## d[5,1]     -4.95    0.02 0.34 -5.59 -5.17 -4.94 -4.72 -4.31   436 1.01
## d[5,2]     -2.81    0.01 0.22 -3.27 -2.96 -2.80 -2.65 -2.39   285 1.01
## d[5,3]      0.27    0.01 0.17 -0.06  0.16  0.27  0.39  0.60   193 1.01
## d[5,4]      3.57    0.01 0.26  3.09  3.39  3.57  3.73  4.11   409 1.00
## d[6,1]     -3.90    0.01 0.26 -4.42 -4.07 -3.90 -3.72 -3.42   548 1.00
## d[6,2]     -2.01    0.01 0.17 -2.37 -2.13 -2.01 -1.89 -1.70   355 1.00
## d[6,3]      0.43    0.01 0.14  0.16  0.33  0.43  0.53  0.69   190 1.01
## d[6,4]      3.16    0.01 0.22  2.74  3.01  3.16  3.31  3.60   394 1.01
## d[7,1]     -4.41    0.01 0.30 -5.03 -4.60 -4.39 -4.21 -3.83   659 1.00
## d[7,2]     -2.52    0.01 0.18 -2.87 -2.63 -2.51 -2.40 -2.19   615 1.00
## d[7,3]     -0.32    0.01 0.12 -0.56 -0.40 -0.32 -0.24 -0.09   329 1.00
## d[7,4]      2.70    0.01 0.19  2.34  2.57  2.70  2.83  3.11   373 1.00
## a[1]        2.19    0.01 0.16  1.86  2.08  2.18  2.30  2.51   347 1.00
## a[2]        3.74    0.02 0.29  3.21  3.53  3.73  3.94  4.33   336 1.01
## a[3]        4.35    0.02 0.34  3.69  4.11  4.34  4.58  5.05   251 1.01
## a[4]        3.76    0.02 0.30  3.22  3.56  3.76  3.95  4.39   254 1.00
## a[5]        2.53    0.01 0.19  2.18  2.39  2.52  2.65  2.91   457 1.00
## a[6]        1.89    0.01 0.15  1.63  1.78  1.88  1.99  2.18   546 1.00
## a[7]        1.52    0.01 0.13  1.29  1.43  1.52  1.62  1.78   382 1.00
## theta[500]  0.48    0.01 0.26 -0.04  0.30  0.48  0.66  1.00  1162 1.00
## 
## Samples were drawn using NUTS(diag_e) at Sun Jul 17 16:34:41 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior in a</span>
<span class="co">#  95% probability interval</span>
<span class="co">#  and 80% to contrast the dispersion</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"theta[500]"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## ci_level: 0.8 (80% intervals)</code></pre>
<pre><code>## outer_level: 0.95 (95% intervals)</code></pre>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># traceplots</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="st">"a"</span>, <span class="st">"theta[500]"</span><span class="op">)</span>, inc_warmup <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Gelman-Rubin-Brooks Convergence Criterion</span>
<span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in ggs_grb(ggs(fit, family = c("d"))): At least two chains are required</code></pre>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in ggs_grb(ggs(fit, family = "a")): At least two chains are required</code></pre>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="st">"theta[500]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in max(D$Iteration): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Error in ggs_grb(ggs(fit, family = "theta[500]")): At least two chains are required</code></pre>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># autocorrelation</span>
<span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"d"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"a"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-4.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"theta[500]"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in max(D$Iteration): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Error in sprintf("nLags=%d is larger than number of iterations, computing until max possible lag %d", : invalid format '%d'; use format %f, %e, %g or %a for numeric objects</code></pre>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior density</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d[1,"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-5.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d[2,"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-6.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d[3,"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-7.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d[4,"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-8.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d[5,"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-9.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb377"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d[6,"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-10.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d[7,"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-11.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="st">"]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-12.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span><span class="va">plot.data</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"theta[500]"</span><span class="op">)</span>,prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-peer-int-stan-13.png" width="90%" height="90%"></div>
</div>
<div id="latent-response-formulation" class="section level2" number="11.9">
<h2>
<span class="header-section-number">11.9</span> Latent Response Formulation<a class="anchor" aria-label="anchor" href="#latent-response-formulation"><i class="fas fa-link"></i></a>
</h2>
<p>Connecting IRT models to a factor analytic perspective can be helpful from a modeling standpoint.
Especially when one’s model is multidimensional leading into structural equation models.
A useful connection can be made by introducing extra variable(s) into the model to represent the <em>latent response variable</em> underlying the <em>observed categorical response variable</em>.
We can think of this latent response variables as</p>
<ul>
<li><p>a latent continuous variable hypothesized to underlie the observed categorical variable that discretized due to data collection or difficulty in measurement; or</p></li>
<li><p>when this natural interpretation is not appropriate, we can think of the latent response variable as a propensity measure for the given response. Although this is not a perfect interpretation, the use of a latent response formulation eases some of the computational machinery and allows for a nice connection between IRT and CFA models.</p></li>
</ul>
<p>Next, the latent response formulation is shown for a set of dichotomous outcomes.
This model is conceptually a 2-PL/2-PNO (2 parameter normal ogive) model and is essentially a probit model.
The model can be defined as</p>
<p><span class="math display">\[x^{\ast}_{ij} = a_j\theta_i+d_j+\varepsilon_{ij},\]</span></p>
<p>where, an important feature is how this latent response is related back to the observed indicator. The range of possible values of a latent response is defined conditional on the value of the observed response. That is,
<span class="math display">\[
x^{\ast}_{ij} \sim \cases{
N(a_j\theta_i+d_j, 1)I(x^{\ast}_{ij}\geq0)\ \ \ \ if\ x=1\\
N(a_j\theta_i+d_j, 1)I(x^{\ast}_{ij}&lt;0)\ \ \ \ if\ x=0}
\]</span></p>
<div id="a-comment-on-use-of-jags" class="section level3" number="11.9.1">
<h3>
<span class="header-section-number">11.9.1</span> A Comment on use of JAGS<a class="anchor" aria-label="anchor" href="#a-comment-on-use-of-jags"><i class="fas fa-link"></i></a>
</h3>
<p>After a lot of trial and error in JAGS, I discovered that the model for a latent response is a bit difficult to code up as defined above.
I found a way to utilize the idea of the latent response formulation.
The approach is not perfect and better ways of coding the model are likely more efficient.</p>
<p>In the approached below, which I demonstrate in the example code below, I utilize the model nearly identically to the above specification.
However, I alter the model so that an “observed stochastic node” can be utilized as part of the sampling.
That is, I had to use the latent response variables to obtain a probability of the observed response.
This is straightforward as the latent response variable is based on the normal standard normal distribution and we can use the cumulative normal distribution CDF (Phi) to obtain a probability that represents the probability of responding “1”.
Then a Bernoulli distribution is used as the data model.
This approach is a straightforward addition to the latent response modeling and connects well to what is done in IRT models above.</p>
</div>
<div id="lsat-example-revisted---jags" class="section level3" number="11.9.2">
<h3>
<span class="header-section-number">11.9.2</span> LSAT Example Revisted - JAGS<a class="anchor" aria-label="anchor" href="#lsat-example-revisted---jags"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jags.model.lsat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="co"># latent response variable</span>
    
    <span class="va">xpos</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/base/logical.html">T</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">)</span>
    <span class="va">xneg</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>;<span class="fu"><a href="https://rdrr.io/r/base/logical.html">T</a></span><span class="op">(</span>,<span class="fl">0</span><span class="op">)</span>
    
    <span class="va">mu</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">xpos</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="va">xneg</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span>
    
    <span class="co"># compute probabilities based on probit to obtain probabilities for observed categories</span>
    <span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu">dbern</span><span class="op">(</span><span class="fu">phi</span><span class="op">(</span><span class="va">xstar</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">-</span> <span class="va">d</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

  <span class="op">}</span>
  
  <span class="va">xstar</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">]</span> <span class="op">~</span> <span class="fu">dmnorm.vcov</span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">]</span>, <span class="va">Omega</span><span class="op">)</span>
  
  
<span class="op">}</span>

<span class="va">psi</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>
<span class="va">invpsi</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">psi</span>;
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
  <span class="va">theta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">invpsi</span><span class="op">)</span>  <span class="co"># distribution for the latent variables</span>
<span class="op">}</span>

<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
  <span class="va">d</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span><span class="op">)</span>          <span class="co"># Locations for observables</span>
<span class="op">}</span>
<span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
  <span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span>    <span class="co"># Discriminations for observables</span>
<span class="op">}</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="va">Omega</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">i</span><span class="op">==</span><span class="va">j</span>, <span class="fl">1</span> <span class="op">+</span> <span class="va">psi</span><span class="op">*</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">psi</span><span class="op">*</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">a</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>


<span class="op">}</span> <span class="co"># closes the model</span>

<span class="co"># initial values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"a"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"d"</span>, <span class="st">"theta"</span>, <span class="st">"psi"</span>, <span class="st">"Omega"</span>, <span class="st">"xstar"</span><span class="op">)</span>

<span class="co"># dataset</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/LSAT.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>
  model.file<span class="op">=</span><span class="va">jags.model.lsat</span>,
  data<span class="op">=</span><span class="va">mydata</span>,
  inits<span class="op">=</span><span class="va">start_values</span>,
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  n.iter<span class="op">=</span><span class="fl">2000</span>,
  n.burnin <span class="op">=</span> <span class="fl">1000</span>,
  n.chains <span class="op">=</span> <span class="fl">3</span>,
  progress.bar <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 5000
##    Unobserved stochastic nodes: 12010
##    Total graph size: 53123
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print(fit)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span> <span class="op">%like%</span> <span class="st">"theta"</span> <span class="op">|</span>
                                   <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span> <span class="op">%like%</span> <span class="st">"xstar"</span> <span class="op">)</span>, <span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>##                mean     sd     2.5%      25%      50%      75%    97.5%  Rhat n.eff
## Omega[1,1]    1.006  0.008    1.000    1.001    1.003    1.007    1.030 1.013  1500
## Omega[2,1]    0.003  0.007   -0.007    0.000    0.001    0.005    0.021 1.001  3000
## Omega[3,1]    0.003  0.007   -0.008    0.000    0.001    0.004    0.019 1.015   250
## Omega[4,1]    0.003  0.007   -0.010    0.000    0.001    0.005    0.020 1.009   280
## Omega[5,1]    0.003  0.008   -0.012    0.000    0.001    0.005    0.023 1.003  3000
## Omega[1,2]    0.003  0.007   -0.007    0.000    0.001    0.005    0.021 1.001  3000
## Omega[2,2]    1.006  0.009    1.000    1.000    1.002    1.007    1.032 1.003  3000
## Omega[3,2]    0.002  0.006   -0.008    0.000    0.000    0.003    0.019 1.009   570
## Omega[4,2]    0.002  0.006   -0.010   -0.001    0.000    0.003    0.018 1.001  3000
## Omega[5,2]    0.002  0.008   -0.010   -0.001    0.000    0.003    0.022 1.002  1900
## Omega[1,3]    0.003  0.007   -0.008    0.000    0.001    0.004    0.019 1.015   250
## Omega[2,3]    0.002  0.006   -0.008    0.000    0.000    0.003    0.019 1.009   570
## Omega[3,3]    1.005  0.009    1.000    1.000    1.002    1.007    1.031 1.047   230
## Omega[4,3]    0.002  0.007   -0.009    0.000    0.000    0.003    0.018 1.021   470
## Omega[5,3]    0.002  0.007   -0.010   -0.001    0.000    0.003    0.020 1.009  3000
## Omega[1,4]    0.003  0.007   -0.010    0.000    0.001    0.005    0.020 1.009   280
## Omega[2,4]    0.002  0.006   -0.010   -0.001    0.000    0.003    0.018 1.001  3000
## Omega[3,4]    0.002  0.007   -0.009    0.000    0.000    0.003    0.018 1.021   470
## Omega[4,4]    1.006  0.010    1.000    1.000    1.002    1.007    1.037 1.004  2100
## Omega[5,4]    0.002  0.008   -0.010   -0.001    0.000    0.003    0.023 1.009  1500
## Omega[1,5]    0.003  0.008   -0.012    0.000    0.001    0.005    0.023 1.003  3000
## Omega[2,5]    0.002  0.008   -0.010   -0.001    0.000    0.003    0.022 1.002  1900
## Omega[3,5]    0.002  0.007   -0.010   -0.001    0.000    0.003    0.020 1.009  3000
## Omega[4,5]    0.002  0.008   -0.010   -0.001    0.000    0.003    0.023 1.009  1500
## Omega[5,5]    1.007  0.013    1.000    1.000    1.002    1.008    1.042 1.002  1900
## a[1]          1.000  0.000    1.000    1.000    1.000    1.000    1.000 1.000     1
## a[2]          0.779  1.144   -1.331    0.014    0.695    1.490    3.275 1.005   530
## a[3]          0.722  1.100   -1.318   -0.009    0.658    1.418    3.058 1.001  3000
## a[4]          0.760  1.138   -1.374    0.013    0.709    1.480    3.115 1.003  1400
## a[5]          0.713  1.183   -1.586   -0.084    0.727    1.499    3.023 1.001  2400
## d[1]         -1.786  0.105   -1.994   -1.856   -1.783   -1.715   -1.586 1.009   230
## d[2]         -0.664  0.075   -0.812   -0.715   -0.664   -0.613   -0.521 1.008   390
## d[3]         -0.162  0.069   -0.300   -0.208   -0.161   -0.116   -0.027 1.007   310
## d[4]         -0.875  0.073   -1.024   -0.923   -0.872   -0.824   -0.737 1.015   140
## d[5]         -1.397  0.084   -1.562   -1.450   -1.398   -1.340   -1.231 1.001  2500
## deviance   1874.048 44.526 1787.777 1844.505 1873.781 1903.707 1963.353 1.038    59
## psi           0.006  0.008    0.000    0.001    0.003    0.007    0.030 1.005   440</code></pre>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"xstar[4,4]"</span>,<span class="st">"xstar[4,5]"</span>,<span class="st">"xstar[10,4]"</span>,<span class="st">"xstar[10,5]"</span><span class="op">)</span>,<span class="op">]</span> ,<span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>##               mean    sd   2.5%    25%    50%    75%  97.5%  Rhat n.eff
## xstar[4,4]  -1.502 0.948 -3.426 -2.145 -1.453 -0.829  0.179 1.031    71
## xstar[4,5]   0.863 1.117 -1.072  0.089  0.769  1.537  3.274 1.012   280
## xstar[10,4]  1.052 1.087 -0.838  0.320  0.987  1.675  3.501 1.005   470
## xstar[10,5] -1.880 1.002 -4.120 -2.459 -1.772 -1.185 -0.126 1.018   200</code></pre>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract posteriors for all chains</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu">as.mcmc</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="co"># the below two plots are too big to be useful given the 1000 observations.</span>
<span class="co">#R2jags::traceplot(jags.mcmc)</span>

<span class="co"># gelman-rubin-brook</span>
<span class="co">#gelman.plot(jags.mcmc)</span>

<span class="co"># convert to single data.frame for density plot</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">jags.mcmc</span>, chains<span class="op">=</span><span class="cn">T</span>, iters <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"chain"</span>, <span class="st">"iter"</span>, <span class="va">a</span><span class="op">)</span>


<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-jags-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a["</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-jags-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">50</span>,<span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## Item.1 Item.2 Item.3 Item.4 Item.5 
##      0      1      0      1      1</code></pre>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"xstar[50,1]"</span>, <span class="st">"xstar[50,2]"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-jags-3.png" width="90%" height="90%"></div>
</div>
<div id="lsat-example-revisted---stan" class="section level3" number="11.9.3">
<h3>
<span class="header-section-number">11.9.3</span> LSAT Example Revisted - Stan<a class="anchor" aria-label="anchor" href="#lsat-example-revisted---stan"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_lrv</span> <span class="op">&lt;-</span> <span class="st">[2597 chars quoted with ''']</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">model_lrv</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## functions {
##   //x = data vector of 1,2,...,nlevs to determine which nu to use
##   //mu=vector of K means fixed to 0 to align with blavaan
##   //L= cholesky  factor for K variables
##   //b=vector of bounds/threshold values
##   //u=vector of random uniform numbers (K)
##   vector[] tmvn(int[] y, vector mu, matrix L, vector b, real[] u) {
##     int K = rows(mu);
##     vector[K] d;
##     vector[K] z;
##     vector[K] out[2];
##     for (k in 1:K) {
##       int km1 = k - 1;
##       real nu;
##       //y==0 =&gt; upper bound only
##       if (y[k] == 0) {
##         real z_star = (b[k] - (mu[k] + ((k &gt; 1) ? L[k,1:km1] * head(z, km1) : 0))) /  L[k,k];
##         real u_star = Phi(z_star); //normal CDF for implied density of TMVN
##         nu = u_star * u[k];
##         d[k] = u_star;
##       }
##       //y==1 =&gt; lower bound only
##       if(y[k] == 1) {
##         real z_star = (b[k] - (mu[k] + ((k &gt; 1) ? L[k,1:km1] * head(z, km1) : 0))) /  L[k,k];
##         real u_star = Phi(z_star);
##         d[k] = 1 - u_star;
##         nu = u_star + d[k] * u[k];
##       }
##       z[k] = inv_Phi(nu); //convert back to z-score from uniform variate
##     }
## 
##     out[1] = z; //simulated ystar value
##     out[2] = d; //density
##     return(out);
##   }
## 
## }
## data {
##   int&lt;lower=1&gt;  N;
##   int&lt;lower=1&gt;  J;
##   array[N, J] int&lt;lower=0, upper=1&gt; x;
## }
## 
## parameters {
##   vector[J] tau; //threshold parameters
##   vector[J-1] lambda_fr; //factor loadings
##   real&lt;lower=0&gt; psi; // factor standard deviation
##   real eta[N]; //factor scores
##   array[N, J] real&lt;lower=0, upper=1&gt; u; // nuisance that absorbs inequality constraints
## }
## 
## transformed parameters {
##   vector[J] lambda;
##   matrix[J,J] Omega;
##   matrix[J,J] L_Omega;
##   real psi_var;
## 
##   lambda[1] = 1;
##   lambda[2:J] = lambda_fr;
##   psi_var = psi^2;
## 
##   for(d in 1:J){
##     for(f in 1:J){
##       if(d==f){
##         Omega[d,f] = 1 + psi_var*lambda[d]^2;
##       } else {
##         Omega[d,f] = psi_var*lambda[d]*lambda[f];
##       }
##     }
##   }
##   //decomponse for use in stan sampling statement
##   L_Omega = cholesky_decompose(Omega);
## }
## 
## model {
##   for(n in 1:N)
##     target += log(tmvn(x[n,1:J], rep_vector(0,J), L_Omega, tau, u[n,1:J])[2]);
##   // Jacobian adjustments to kernal density for use of TMVN density on x*
##   // implicit: u ~ uniform(0,1)
##   // truncated multivariate normal
##   
##   
##   //priors for measurement model
##   psi ~ gamma(1, 0.5);
##   eta ~ normal(0,psi);
##   lambda_fr ~ normal(0,1.5);
##   tau ~ normal(0,1.5);
## }
## 
## generated quantities {
##   corr_matrix[J] Omega_cor;
## 
##   for(d in 1:J){
##     for(f in 1:J){
##       if(d==f){
##         Omega_cor[d,f] = 1;
##       } else {
##         Omega_cor[d,f] = Omega[d,f]/(sqrt(Omega[d,d])*sqrt(Omega[f,f]));
##       }
##     }
##   }
## }</code></pre>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># initial values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"tau"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span>,
       <span class="st">"lambda_fr"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"tau"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span>, <span class="op">-</span><span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"lambda_fr"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"tau"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span>, <span class="fl">3.00</span><span class="op">)</span>,
       <span class="st">"lambda_fr"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># dataset</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"data/LSAT.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>


<span class="co"># Next, need to fit the model</span>
<span class="co">#   I have explicitly outlined some common parameters</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan</span><span class="op">(</span>
  model_code <span class="op">=</span> <span class="va">model_lrv</span>, <span class="co"># model code to be compiled</span>
  data <span class="op">=</span> <span class="va">mydata</span>,          <span class="co"># my data</span>
  <span class="co">#init = start_values,    # starting values</span>
  chains <span class="op">=</span> <span class="fl">4</span>,             <span class="co"># number of Markov chains</span>
  warmup <span class="op">=</span> <span class="fl">1000</span>,          <span class="co"># number of warm up iterations per chain</span>
  iter <span class="op">=</span> <span class="fl">2000</span>,            <span class="co"># total number of iterations per chain</span>
  cores <span class="op">=</span> <span class="fl">4</span>,              <span class="co"># number of cores (could use one per chain)</span>
  refresh <span class="op">=</span> <span class="fl">0</span>             <span class="co"># no progress shown</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Warning: There were 111 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See
## https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</code></pre>
<pre><code>## Warning: There were 4 chains where the estimated Bayesian Fraction of Missing Information was low. See
## https://mc-stan.org/misc/warnings.html#bfmi-low</code></pre>
<pre><code>## Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
<pre><code>## Warning: The largest R-hat is NA, indicating chains have not mixed.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#r-hat</code></pre>
<pre><code>## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
<pre><code>## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
## Running the chains for more iterations may help. See
## https://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># first get a basic breakdown of the posteriors</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="st">"tau"</span>,<span class="st">"psi"</span>, <span class="st">"Omega_cor"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Stan model: anon_model.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                 mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## lambda[1]       1.00     NaN 0.00  1.00  1.00  1.00  1.00  1.00   NaN  NaN
## lambda[2]       1.36    0.08 0.50  0.58  1.00  1.29  1.64  2.55    39 1.09
## lambda[3]       1.64    0.08 0.57  0.77  1.23  1.55  1.96  3.02    55 1.07
## lambda[4]       1.28    0.09 0.49  0.53  0.94  1.21  1.56  2.44    31 1.11
## lambda[5]       1.15    0.07 0.49  0.39  0.80  1.08  1.43  2.28    54 1.08
## tau[1]         -1.52    0.01 0.08 -1.68 -1.56 -1.51 -1.46 -1.38    56 1.07
## tau[2]         -0.60    0.00 0.05 -0.71 -0.64 -0.60 -0.57 -0.50  3383 1.00
## tau[3]         -0.15    0.00 0.05 -0.24 -0.18 -0.15 -0.12 -0.06  5483 1.00
## tau[4]         -0.77    0.00 0.06 -0.89 -0.81 -0.77 -0.74 -0.67  2969 1.00
## tau[5]         -1.20    0.00 0.07 -1.36 -1.24 -1.20 -1.16 -1.08  2196 1.00
## psi             0.34    0.02 0.09  0.19  0.28  0.32  0.38  0.61    14 1.27
## Omega_cor[1,1]  1.00     NaN 0.00  1.00  1.00  1.00  1.00  1.00   NaN  NaN
## Omega_cor[1,2]  0.12    0.01 0.04  0.06  0.09  0.12  0.15  0.22    29 1.12
## Omega_cor[1,3]  0.14    0.01 0.05  0.07  0.11  0.14  0.17  0.26    21 1.16
## Omega_cor[1,4]  0.12    0.01 0.04  0.05  0.09  0.11  0.14  0.20    40 1.10
## Omega_cor[1,5]  0.10    0.01 0.04  0.04  0.08  0.10  0.13  0.19    57 1.07
## Omega_cor[2,1]  0.12    0.01 0.04  0.06  0.09  0.12  0.15  0.22    29 1.12
## Omega_cor[2,2]  1.00     NaN 0.00  1.00  1.00  1.00  1.00  1.00   NaN  NaN
## Omega_cor[2,3]  0.17    0.00 0.05  0.08  0.14  0.17  0.21  0.27  1647 1.01
## Omega_cor[2,4]  0.14    0.00 0.04  0.07  0.11  0.14  0.17  0.23  2857 1.00
## Omega_cor[2,5]  0.13    0.00 0.05  0.05  0.09  0.13  0.16  0.23  1912 1.00
## Omega_cor[3,1]  0.14    0.01 0.05  0.07  0.11  0.14  0.17  0.26    21 1.16
## Omega_cor[3,2]  0.17    0.00 0.05  0.08  0.14  0.17  0.21  0.27  1647 1.01
## Omega_cor[3,3]  1.00     NaN 0.00  1.00  1.00  1.00  1.00  1.00   NaN  NaN
## Omega_cor[3,4]  0.17    0.00 0.05  0.08  0.13  0.17  0.20  0.26  1953 1.00
## Omega_cor[3,5]  0.15    0.00 0.05  0.07  0.12  0.15  0.18  0.24  2782 1.00
## Omega_cor[4,1]  0.12    0.01 0.04  0.05  0.09  0.11  0.14  0.20    40 1.10
## Omega_cor[4,2]  0.14    0.00 0.04  0.07  0.11  0.14  0.17  0.23  2857 1.00
## Omega_cor[4,3]  0.17    0.00 0.05  0.08  0.13  0.17  0.20  0.26  1953 1.00
## Omega_cor[4,4]  1.00     NaN 0.00  1.00  1.00  1.00  1.00  1.00   NaN  NaN
## Omega_cor[4,5]  0.12    0.00 0.05  0.04  0.09  0.12  0.15  0.22  1948 1.00
## Omega_cor[5,1]  0.10    0.01 0.04  0.04  0.08  0.10  0.13  0.19    57 1.07
## Omega_cor[5,2]  0.13    0.00 0.05  0.05  0.09  0.13  0.16  0.23  1912 1.00
## Omega_cor[5,3]  0.15    0.00 0.05  0.07  0.12  0.15  0.18  0.24  2782 1.00
## Omega_cor[5,4]  0.12    0.00 0.05  0.04  0.09  0.12  0.15  0.22  1948 1.00
## Omega_cor[5,5]  1.00     NaN 0.00  1.00  1.00  1.00  1.00  1.00   NaN  NaN
## 
## Samples were drawn using NUTS(diag_e) at Sun Jul 17 16:59:09 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">fit</span>,pars <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lambda_fr"</span>, <span class="st">"tau"</span>, <span class="st">"psi"</span><span class="op">)</span>, inc_warmup <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Gelman-Rubin-Brooks Convergence Criterion</span>
<span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lambda_fr"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="st">"tau"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_grb</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family <span class="op">=</span> <span class="st">"psi"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-4.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># autocorrelation</span>
<span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"lambda_fr"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-5.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"tau"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-6.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggs_autocorrelation</span><span class="op">(</span><span class="fu">ggs</span><span class="op">(</span><span class="va">fit</span>, family<span class="op">=</span><span class="st">"psi"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-7.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior density</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lambda_fr["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="st">"]"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-8.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"tau["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-9.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"psi"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp11-lrv-lsat-stan-10.png" width="90%" height="90%"></div>
</div>
</div>
<div id="final-notes" class="section level2" number="11.10">
<h2>
<span class="header-section-number">11.10</span> Final Notes<a class="anchor" aria-label="anchor" href="#final-notes"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>A fully Bayesian approach to psychometric modeling helps highlight the major similarities between factor analytic frameworks and the item response theory perspective.</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="model-evaluation.html"><span class="header-section-number">10</span> Model Evaluation</a></div>
<div class="next"><a href="missing-data-modeling.html"><span class="header-section-number">12</span> Missing Data Modeling</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#item-response-theory"><span class="header-section-number">11</span> Item Response Theory</a></li>
<li><a class="nav-link" href="#irt-models-for-dichotomous-data"><span class="header-section-number">11.1</span> IRT Models for Dichotomous Data</a></li>
<li><a class="nav-link" href="#pl-lsat-example"><span class="header-section-number">11.2</span> 3-PL LSAT Example</a></li>
<li>
<a class="nav-link" href="#lsat-example---jags"><span class="header-section-number">11.3</span> LSAT Example - JAGS</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#posterior-predicted-distributions"><span class="header-section-number">11.3.1</span> Posterior Predicted Distributions</a></li></ul>
</li>
<li><a class="nav-link" href="#lsat-example---stan"><span class="header-section-number">11.4</span> LSAT Example - Stan</a></li>
<li><a class="nav-link" href="#irt-models-for-polytomous-data"><span class="header-section-number">11.5</span> IRT Models for Polytomous Data</a></li>
<li>
<a class="nav-link" href="#grm-peer-interactions-example"><span class="header-section-number">11.6</span> GRM Peer Interactions Example</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#example-specific-model-specification"><span class="header-section-number">11.6.1</span> Example Specific Model Specification</a></li></ul>
</li>
<li><a class="nav-link" href="#pi-example---jags"><span class="header-section-number">11.7</span> PI Example - JAGS</a></li>
<li><a class="nav-link" href="#pi-example---stan"><span class="header-section-number">11.8</span> PI Example - Stan</a></li>
<li>
<a class="nav-link" href="#latent-response-formulation"><span class="header-section-number">11.9</span> Latent Response Formulation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#a-comment-on-use-of-jags"><span class="header-section-number">11.9.1</span> A Comment on use of JAGS</a></li>
<li><a class="nav-link" href="#lsat-example-revisted---jags"><span class="header-section-number">11.9.2</span> LSAT Example Revisted - JAGS</a></li>
<li><a class="nav-link" href="#lsat-example-revisted---stan"><span class="header-section-number">11.9.3</span> LSAT Example Revisted - Stan</a></li>
</ul>
</li>
<li><a class="nav-link" href="#final-notes"><span class="header-section-number">11.10</span> Final Notes</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling/blob/master/11-irt.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling/edit/master/11-irt.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</strong>" was written by R. Noah Padgett. It was last built on 2022-07-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
