<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Introduction to Bayesian Inference | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</title>
<meta name="author" content="R. Noah Padgett">
<meta name="description" content="Chapter 2 is focused on introducing the fundamentals of Bayesian modeling. I will briefly reiterate some of these concepts, but Levy and Mislevy did an excellent job introducing the basic concepts...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 2 Introduction to Bayesian Inference | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy">
<meta property="og:type" content="book">
<meta property="og:description" content="Chapter 2 is focused on introducing the fundamentals of Bayesian modeling. I will briefly reiterate some of these concepts, but Levy and Mislevy did an excellent job introducing the basic concepts...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Introduction to Bayesian Inference | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy">
<meta name="twitter:description" content="Chapter 2 is focused on introducing the fundamentals of Bayesian modeling. I will briefly reiterate some of these concepts, but Levy and Mislevy did an excellent job introducing the basic concepts...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li class="book-part">Foundations</li>
<li><a class="" href="index.html"><span class="header-section-number">1</span> Index</a></li>
<li><a class="active" href="chp2.html"><span class="header-section-number">2</span> Introduction to Bayesian Inference</a></li>
<li><a class="" href="conceptual-issues-in-bayesian-inference.html"><span class="header-section-number">3</span> Conceptual Issues in Bayesian Inference</a></li>
<li><a class="" href="normal-distribution-models.html"><span class="header-section-number">4</span> Normal Distribution Models</a></li>
<li><a class="" href="markov-chain-monte-carlo-estimation.html"><span class="header-section-number">5</span> Markov Chain Monte Carlo Estimation</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">6</span> Regression</a></li>
<li class="book-part">Psychometrics</li>
<li><a class="" href="canonical-bayesian-psychometric-modeling.html"><span class="header-section-number">7</span> Canonical Bayesian Psychometric Modeling</a></li>
<li><a class="" href="classical-test-theory.html"><span class="header-section-number">8</span> Classical Test Theory</a></li>
<li><a class="" href="confirmatory-factor-analysis.html"><span class="header-section-number">9</span> Confirmatory Factor Analysis</a></li>
<li><a class="" href="model-evaluation.html"><span class="header-section-number">10</span> Model Evaluation</a></li>
<li><a class="" href="item-response-theory.html"><span class="header-section-number">11</span> Item Response Theory</a></li>
<li><a class="" href="missing-data-modeling.html"><span class="header-section-number">12</span> Missing Data Modeling</a></li>
<li><a class="" href="latent-class-analysis.html"><span class="header-section-number">13</span> Latent Class Analysis</a></li>
<li><a class="" href="bayesian-networks.html"><span class="header-section-number">14</span> Bayesian Networks</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chp2" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Introduction to Bayesian Inference<a class="anchor" aria-label="anchor" href="#chp2"><i class="fas fa-link"></i></a>
</h1>
<p>Chapter <a href="chp2.html#chp2">2</a> is focused on introducing the fundamentals of Bayesian modeling.
I will briefly reiterate some of these concepts, but Levy and Mislevy did an excellent job introducing the basic concepts so I defer to them.
A few points I would like to highlight are</p>
<ol style="list-style-type: decimal">
<li>
<p>The concept of likelihood is fundamental to Bayesian methods and frequentist methods as well.</p>
<p>The likelihood function (denoted <span class="math inline">\(p(\mathbf{x} \mid \theta)\)</span> or equivalently <span class="math inline">\(L(\theta \mid \mathbf{x})\)</span>) is fundamental as this conditional probability describes our beliefs about the <em>data generating process</em>.
Another way of thinking about the likelihood function is as the data model.
The data model decribes how parameters of interest relates to the observed data.
This key concept is used in frequentist methods (e.g., maximum likelihood estimation) to obtain point estimates of model parameters.
A fundamental difference between maximum likelihood and Bayesian estimation is how we use the likelihood function to construct interval estimates of parameters (see next point).</p>
</li>
<li>
<p>Interval estimates in Bayesian methods do not rely on the idea of <em>repeated sampling</em>.</p>
<p>In frequentist analyses, the construction of interval estimates around maximum likelihood estimators is dependent on utilizing repeated sampling paradigm.
The interval estimate around the MLE is referred to the sampling distribution of the parameter estimator.
BPM discusses these features of maximum likelihood well on p. 26.
In Bayesian methods, an interval estimate is constructed based on the distribution of the <em>parameter</em> and not the <em>parameter estimator</em>.
This distinction makes Bayesian intervals based on the likely values of the parameter based on our prior beliefs and observed data.</p>
</li>
<li>
<p>Bayes Theorem</p>
<p>Bayes theorem is the underlying engine of all Bayesian methods.
We use Bayes theorm to decompose conditional probabilities so that they can work for us.
As an analyst, we interested in the plausible values of the parameters based on the observed data.
This can be expressed as a conditional probability (<span class="math inline">\(p(\theta \mid \mathbf{x})\)</span>).
Bayes theorm states that
<span class="math display" id="eq:bayes">\[\begin{equation}
  \begin{split}
  p(\theta \mid \mathbf{x}) &amp;= \frac{p(\mathbf{x}, \theta)}{p(\mathbf{x})}\\
&amp;= \frac{p(\mathbf{x}\mid \theta)p(\theta)}{p(\mathbf{x})}.\\
  \end{split}
  \tag{2.1}
\end{equation}\]</span></p>
</li>
<li>
<p>The distinction between frequentist and Bayesian approaches is more than treating model parameters as <em>random</em>. A different way to stating the difference between frequentist and Bayesian approaches is based on what is being conditioned on to make inferences.</p>
<p>In a classic frequentist hypothesis testing scenario, the model parameters are conditioned on to calculate the probability of the observed data (i.e., <span class="math inline">\(\mathrm{Pr}(data \mid \theta)\)</span>).
This implies that the data are treated as random variables, but this does not exclude the fact the <span class="math inline">\(\theta\)</span> can be a collection of parameters that have random components (e.g., random intercepts in HLM).
However, in a Bayesian model, the model parameters are the object of interest and the data are conditioned on (i.e., <span class="math inline">\(\mathrm{Pr}(\theta \mid data)\)</span>).
This implies that the data are treated as a fixed entity that is used to construct inferences.
This is how BPM related Bayesian inference to inductive reasoning.
The inductive reasoning comes from taking observations and trying to making claims about the general.</p>
</li>
</ol>
<div id="beta-binomial-example" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Beta-binomial Example<a class="anchor" aria-label="anchor" href="#beta-binomial-example"><i class="fas fa-link"></i></a>
</h2>
<p>Here I go through the the first example from BPM.
The example is a relatively simple beta-binomial model.
Which is a way of modeling the number of occurrences of a bernoulli process.
For example, suppose we were interested in the number of times a coin landed on heads.
Here, we have a set number of coin flips (say <span class="math inline">\(J\)</span>) and we are interested in the number of times the coin landed on heads (call this outcome <span class="math inline">\(y\)</span>).
We can model this structure letting <span class="math inline">\(y\)</span> be a binomial random variable which we can express this as
<span class="math display">\[y\sim\mathrm{Binomial}(\theta, J)\]</span>
where <span class="math inline">\(\theta\)</span> is the probability of heads on any given coin toss.
As part of the Bayesian modeling I need to specify my prior belief as to the likely values of <span class="math inline">\(\theta\)</span>.
The probability <span class="math inline">\(\theta\)</span> lies in the interval <span class="math inline">\([0, 1]\)</span>.
A nice probability distribution on this range is the beta distribution.
That is, I can model my belief as to the likely values of the probability of heads by saying that <span class="math inline">\(\theta\)</span> is beta distributed which can be expressed as
<span class="math display">\[\theta \sim \mathrm{Beta}(\alpha,\beta)\]</span>.
The two parameters for the beta distribution are representative of the shape the distribution will take.
When <span class="math inline">\(\alpha = \beta\)</span> the distribution is symmetrical, and when <span class="math inline">\(\alpha = \beta=1\)</span> the beta distribution is flat or uniform over <span class="math inline">\([0,1]\)</span>.
When a distribution is uniform I mean that all values are equally likely over the range of possible values which can be described as having the belief that all values are equally plausible.</p>
<p>This model can be represented in a couple different ways. One way is as a <em>directed acyclic graph</em> (DAG).
A DAG representation is very similar to path models in general structural equation modeling.
The directed nature of the diagram highlights how observed variables (e.g., <span class="math inline">\(y\)</span>) are modeled by unknown parameters <span class="math inline">\(\theta\)</span>.
All observed or explicitly defined variables/values are in rectangles while any latent variable or model parameter are in circles.
DAG representation of model for the beta-binomal model is</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp2-dag-1"></span>
<img src="dag/chp2-beta-binomial.png" alt="Directed Acyclic Graph (DAG) for the beta-binomial model" width="50%" height="90%"><p class="caption">
Figure 2.1: Directed Acyclic Graph (DAG) for the beta-binomial model
</p>
</div>
<p>I have given an alternative DAG representation that includes all relevant details.
In terms of a DAG, I prefer this representation as all the assumed model components are made explicit.
However, in more complex models this approach will likely lead to very dense and possible unuseful representations.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp2-dag-2"></span>
<img src="dag/chp2-beta-binomial-full.png" alt="DAG with explicit representation for all beta-binomial model components" width="75%" height="90%"><p class="caption">
Figure 2.2: DAG with explicit representation for all beta-binomial model components
</p>
</div>
<p>Yet another alternative representation is what I call a model specification chart.
This takes on a similar feel as a DAG in that the flow of model parameters can be shown, but with the major difference that I use the distributional notation explicitly.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp2-spec-1"></span>
<img src="model-spec/chp2-beta-binomial.png" alt="Model specification diagram for beta-binomial model" width="90%" height="90%"><p class="caption">
Figure 2.3: Model specification diagram for beta-binomial model
</p>
</div>
<p>I will stick with these last two representations as much as possible.</p>
<div id="computation-using-stan" class="section level3" number="2.1.1">
<h3>
<span class="header-section-number">2.1.1</span> Computation using Stan<a class="anchor" aria-label="anchor" href="#computation-using-stan"><i class="fas fa-link"></i></a>
</h3>
<p>Now, I’m finally getting to the analysis part.
I have done my best to be descriptive of what the <code>Stan</code> code represents and how it works (in a general how to use this sense).
I highly recommend a look at the example analysis by the development team to help see their approach as well (see here <a href="https://mc-stan.org/rstan/articles/rstan.html">Stan analysis</a>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_beta_binomial</span> <span class="op">&lt;-</span> <span class="st">'
// data block needs to describe the variable
//  type (e.g., real, int, etc.) and the name
//  in the data object passed
data {
  int J;
  int y;
  real alpha;
  real beta;
}
// parameters block needs to specify the 
//  unknown parameters
parameters {
  real&lt;lower=0, upper=1&gt;theta;
}
// model block needs to describe the data-model
//  and the prior specification
model {
  y ~ binomial(J, theta);
  theta ~ beta(alpha, beta);
}
// there must be a blank line after all blocks

'</span>
<span class="co"># data must be in a list</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="fl">10</span>,
  y <span class="op">=</span> <span class="fl">7</span>,
  alpha <span class="op">=</span> <span class="fl">6</span>,
  beta <span class="op">=</span> <span class="fl">6</span>
<span class="op">)</span>

<span class="co"># start values can be done automatically by stan or</span>
<span class="co">#   done explicitly be the analyst (me). I prefer </span>
<span class="co">#   to try to be explicit so that I can *try* to </span>
<span class="co">#   guarantee that the initial chains start.</span>
<span class="co">#   The values can be specified as a function </span>
<span class="co">#   which lists the values to the respective </span>
<span class="co">#   parameters</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Next, need to fit the model</span>
<span class="co">#   I have explicited outlined some common parameters</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan</span><span class="op">(</span>
  model_code <span class="op">=</span> <span class="va">model_beta_binomial</span>, <span class="co"># model code to be compiled</span>
  data <span class="op">=</span> <span class="va">mydata</span>,          <span class="co"># my data</span>
  init <span class="op">=</span> <span class="va">start_values</span>,    <span class="co"># starting values</span>
  chains <span class="op">=</span> <span class="fl">4</span>,             <span class="co"># number of Markov chains</span>
  warmup <span class="op">=</span> <span class="fl">1000</span>,          <span class="co"># number of warmup iterations per chain</span>
  iter <span class="op">=</span> <span class="fl">2000</span>,            <span class="co"># total number of iterations per chain</span>
  cores <span class="op">=</span> <span class="fl">2</span>,              <span class="co"># number of cores (could use one per chain)</span>
  refresh <span class="op">=</span> <span class="fl">0</span>             <span class="co"># no progress shown</span>
<span class="op">)</span>

<span class="co"># first get a basic breakdown of the posteriors</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span>, pars<span class="op">=</span><span class="st">"theta"</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Stan model: anon_model.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##       mean se_mean  sd 2.5%  25% 50%  75% 97.5% n_eff Rhat
## theta 0.59       0 0.1 0.39 0.53 0.6 0.66  0.78  1511    1
## 
## Samples were drawn using NUTS(diag_e) at Sun Jun 19 17:27:45 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior in a</span>
<span class="co">#  95% probability interval</span>
<span class="co">#  and 80% to contrast the dispersion</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span>, pars<span class="op">=</span><span class="st">"theta"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># traceplots</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">fit</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>, inc_warmup <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior density</span>
<span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">posterior</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># I prefer a posterior plot that includes prior and MLE</span>
<span class="va">MLE</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>
<span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">prior.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span>, dens <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Posterior"</span><span class="op">=</span><span class="st">"#0072B2"</span>, <span class="st">"Prior"</span><span class="op">=</span><span class="st">"#E69F00"</span>, <span class="st">"MLE"</span><span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="co">#"#56B4E9", "#E69F00" "#CC79A7"</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">theta</span>, color<span class="op">=</span><span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">prior.dat</span>,
            <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">dens</span>, color<span class="op">=</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">MLE</span>, color<span class="op">=</span><span class="st">"MLE"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cols</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-4.png" width="90%" height="90%"></div>
</div>
<div id="computation-using-winbugs-openbugs" class="section level3" number="2.1.2">
<h3>
<span class="header-section-number">2.1.2</span> Computation using WinBUGS (OpenBUGS)<a class="anchor" aria-label="anchor" href="#computation-using-winbugs-openbugs"><i class="fas fa-link"></i></a>
</h3>
<p>Here, I am simply contrasting the computation from Stan to how BPM describes the computations using WinBUGS.
I have downloaded the .bug file from the text website and I will load it into R for viewing.</p>
<p>First, let’s take a look at the model described by BPM on p. 39.</p>
<pre><code># A model block
model{
  #################################
  # Prior distribution
  #################################
  theta ~ dbeta(alpha,beta)
  #################################
  # Conditional distribution of the data
  #################################
  y ~ dbin(theta, J)
}
# data statement
list(J = 10, y = 7, alpha = 6, beta = 6)</code></pre>
<p>Next, we want to use the above model.
Using OpensBUGS through R can be a little clunky as I had to create objects with the filepaths of the data and model code then get R to read those in through the function <code>openbugs</code>.
Otherwise, the code is similar to style to the code used for calling Stan.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># model code</span>
<span class="va">model.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">w.d</span>,<span class="st">"/code/Binomial/Binomial Model.bug"</span><span class="op">)</span>

<span class="co"># get data file</span>
<span class="va">data.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">w.d</span>,<span class="st">"/code/Binomial/Binomial data.txt"</span><span class="op">)</span>

<span class="co"># starting values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">openbugs</span><span class="op">(</span>
  data<span class="op">=</span> <span class="va">data.file</span>, 
  model.file <span class="op">=</span> <span class="va">model.file</span>, <span class="co"># R grabs the file and runs it in openBUGS</span>
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  inits<span class="op">=</span><span class="va">start_values</span>,
  n.chains <span class="op">=</span> <span class="fl">4</span>,
  n.iter <span class="op">=</span> <span class="fl">2000</span>,
  n.burnin <span class="op">=</span> <span class="fl">1000</span>,
  n.thin <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="va">posterior</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">sims.matrix</span>

<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">posterior</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="va">plot_title</span>


<span class="va">MLE</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>
<span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">prior.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span>, dens <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Posterior"</span><span class="op">=</span><span class="st">"#0072B2"</span>, <span class="st">"Prior"</span><span class="op">=</span><span class="st">"#E69F00"</span>, <span class="st">"MLE"</span><span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="co">#"#56B4E9", "#E69F00" "#CC79A7"</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">theta</span>, color<span class="op">=</span><span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">prior.dat</span>,
            <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">dens</span>, color<span class="op">=</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">MLE</span>, color<span class="op">=</span><span class="st">"MLE"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Posterior density comparedto prior and MLE"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cols</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="computation-using-jags-r2jags" class="section level3" number="2.1.3">
<h3>
<span class="header-section-number">2.1.3</span> Computation using JAGS (R2jags)<a class="anchor" aria-label="anchor" href="#computation-using-jags-r2jags"><i class="fas fa-link"></i></a>
</h3>
<p>Here, I utilize JAGS, which is nearly identical to WinBUGS in how the underlying mechanics work to compute the posterior but is easily to use through R.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># model code</span>
<span class="va">jags.model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#################################</span>
  <span class="co"># Conditional distribution of the data</span>
  <span class="co">#################################</span>
  <span class="va">y</span> <span class="op">~</span> <span class="fu">dbin</span><span class="op">(</span><span class="va">theta</span>, <span class="va">J</span><span class="op">)</span>
  <span class="co">#################################</span>
  <span class="co"># Prior distribution</span>
  <span class="co">#################################</span>
  <span class="va">theta</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># data</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="fl">10</span>,
  y <span class="op">=</span> <span class="fl">7</span>,
  alpha <span class="op">=</span> <span class="fl">6</span>,
  beta <span class="op">=</span> <span class="fl">6</span>
<span class="op">)</span>
<span class="co"># starting values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>
  model.file<span class="op">=</span><span class="va">jags.model</span>,
  data<span class="op">=</span><span class="va">mydata</span>,
  inits<span class="op">=</span><span class="va">start_values</span>,
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  n.iter<span class="op">=</span><span class="fl">1000</span>,
  n.burnin <span class="op">=</span> <span class="fl">500</span>,
  n.chains <span class="op">=</span> <span class="fl">4</span>,
  n.thin<span class="op">=</span><span class="fl">1</span>,
  progress.bar <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 1
##    Unobserved stochastic nodes: 1
##    Total graph size: 5
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Bugs model at "C:/Users/noahp/AppData/Local/Temp/RtmpQR8sbs/model45447f3b5e11.txt", fit using jags,
##  4 chains, each with 1000 iterations (first 500 discarded)
##  n.sims = 2000 iterations saved
##          mu.vect sd.vect  2.5%   25%   50%   75% 97.5%  Rhat n.eff
## theta      0.596   0.103 0.396 0.525 0.596 0.670 0.791 1.002  2000
## deviance   3.536   1.056 2.644 2.749 3.151 3.937 6.416 1.004   960
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 0.6 and DIC = 4.1
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract posteriors for all chains</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu">as.mcmc</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="fu">R2jags</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/R2jags/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span></code></pre></div>
<p><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-jags-1.png" width="90%" height="90%"><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-jags-2.png" width="90%" height="90%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert to singel data.frame for density plot</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">jags.mcmc</span>, chains<span class="op">=</span><span class="cn">T</span>, iters <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"chain"</span>, <span class="st">"iter"</span>, <span class="va">a</span><span class="op">)</span>


<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-jags-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MLE</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>
<span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">prior.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span>, dens <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Posterior"</span><span class="op">=</span><span class="st">"#0072B2"</span>, <span class="st">"Prior"</span><span class="op">=</span><span class="st">"#E69F00"</span>, <span class="st">"MLE"</span><span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="co">#"#56B4E9", "#E69F00" "#CC79A7"</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>data<span class="op">=</span><span class="va">plot.data</span>,
               <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">theta</span>, color<span class="op">=</span><span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">prior.dat</span>,
            <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">dens</span>, color<span class="op">=</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">MLE</span>, color<span class="op">=</span><span class="st">"MLE"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Posterior density comparedto prior and MLE"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cols</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bin-fit-jags-4.png" width="90%" height="90%"></div>
</div>
</div>
<div id="beta-bernoulli-example" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Beta-Bernoulli Example<a class="anchor" aria-label="anchor" href="#beta-bernoulli-example"><i class="fas fa-link"></i></a>
</h2>
<p>For this next example, I use the same data as the previous model.
But now, instead of treating the individual events as part of a whole and sum over the successes, I will treat the model in a more hierarchical manner.
A hierarchical model here simply implies that I’ll be using the same probability function for all individual observations.
We express this by saying that the observations depend on the index (<span class="math inline">\(j=1, 2, ..., J\)</span>) but that the parameter of interest does not vary across <span class="math inline">\(j\)</span>.
Two DAG representations similar to the previous examples are shown below.
The major difference in these representations from the previous example is the inclusion of a <em>plate</em> that represents the observations depend on the index <span class="math inline">\(j\)</span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp2-dag-3"></span>
<img src="dag/chp2-beta-bernoulli-plate.png" alt="DAG for the beta-bernoulli model" width="75%" height="90%"><p class="caption">
Figure 2.4: DAG for the beta-bernoulli model
</p>
</div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp2-dag-4"></span>
<img src="dag/chp2-beta-bernoulli-plate-full.png" alt="DAG with explicit representation for all beta-bernoulli model components" width="75%" height="90%"><p class="caption">
Figure 2.5: DAG with explicit representation for all beta-bernoulli model components
</p>
</div>
<p>In my flavor of representation, this model can be expressed as</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chp2-spec-2"></span>
<img src="model-spec/chp2-beta-bernoulli.png" alt="Model specification diagram for beta-bernoulli model" width="90%" height="90%"><p class="caption">
Figure 2.6: Model specification diagram for beta-bernoulli model
</p>
</div>
<p>We will use the same <span class="math inline">\(\mathrm{Beta}(\alpha, \beta)\)</span> prior for <span class="math inline">\(\theta\)</span> as in the previous example.
The model code changes to the following,</p>
<div id="computation-using-stan-1" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> Computation using Stan<a class="anchor" aria-label="anchor" href="#computation-using-stan-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_beta_bernoulli</span> <span class="op">&lt;-</span> <span class="st">'
// data block needs to describe the variable
//  type (e.g., real, int, etc.) and the name
//  in the data object passed
data {
  int J;
  int y[J];  //declare observations as an integer vector of length J
  real alpha;
  real beta;
}
// parameters block needs to specify the 
//  unknown parameters
parameters {
  real&lt;lower=0, upper=1&gt;theta;
}
// model block needs to describe the data-model
//  and the prior specification
model {
  for(j in 1:J){
    y[j] ~ bernoulli(theta);
  }
  theta ~ beta(alpha, beta);
}
// there must be a blank line after all blocks

'</span>
<span class="co"># data must be in a list</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="fl">10</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
  alpha <span class="op">=</span> <span class="fl">6</span>,
  beta <span class="op">=</span> <span class="fl">6</span>
<span class="op">)</span>

<span class="co"># start values can be done automatically by stan or</span>
<span class="co">#   done explicitly be the analyst (me). I prefer </span>
<span class="co">#   to try to be explicit so that I can *try* to </span>
<span class="co">#   guarantee that the initial chains start.</span>
<span class="co">#   The values can be specified as a function </span>
<span class="co">#   which lists the values to the respective </span>
<span class="co">#   parameters</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Next, need to fit the model</span>
<span class="co">#   I have explicited outlined some common parameters</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan</span><span class="op">(</span>
  model_code <span class="op">=</span> <span class="va">model_beta_bernoulli</span>, <span class="co"># model code to be compiled</span>
  data <span class="op">=</span> <span class="va">mydata</span>,          <span class="co"># my data</span>
  init <span class="op">=</span> <span class="va">start_values</span>,    <span class="co"># starting values</span>
  chains <span class="op">=</span> <span class="fl">4</span>,             <span class="co"># number of Markov chains</span>
  warmup <span class="op">=</span> <span class="fl">1000</span>,          <span class="co"># number of warmup iterations per chain</span>
  iter <span class="op">=</span> <span class="fl">2000</span>,            <span class="co"># total number of iterations per chain</span>
  cores <span class="op">=</span> <span class="fl">2</span>,              <span class="co"># number of cores (could use one per chain)</span>
  refresh <span class="op">=</span> <span class="fl">0</span>             <span class="co"># no progress shown</span>
<span class="op">)</span>

<span class="co"># first get a basic breakdown of the posteriors</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span>, pars<span class="op">=</span><span class="st">"theta"</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Stan model: anon_model.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##       mean se_mean  sd 2.5%  25% 50%  75% 97.5% n_eff Rhat
## theta 0.59       0 0.1 0.38 0.53 0.6 0.67  0.78  1527    1
## 
## Samples were drawn using NUTS(diag_e) at Sun Jun 19 17:28:34 2022.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior in a</span>
<span class="co">#  95% probability interval</span>
<span class="co">#  and 80% to contrast the dispersion</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span>, pars<span class="op">=</span><span class="st">"theta"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-stan-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># traceplots</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">fit</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>, inc_warmup <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-stan-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the posterior density</span>
<span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">posterior</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-stan-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># I prefer a posterior plot that includes prior and MLE</span>
<span class="va">MLE</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>
<span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">prior.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span>, dens <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Posterior"</span><span class="op">=</span><span class="st">"#0072B2"</span>, <span class="st">"Prior"</span><span class="op">=</span><span class="st">"#E69F00"</span>, <span class="st">"MLE"</span><span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="co">#"#56B4E9", "#E69F00" "#CC79A7"</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">theta</span>, color<span class="op">=</span><span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">prior.dat</span>,
            <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">dens</span>, color<span class="op">=</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">MLE</span>, color<span class="op">=</span><span class="st">"MLE"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cols</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-stan-4.png" width="90%" height="90%"></div>
</div>
<div id="computation-using-winbugs-openbugs-1" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> Computation using WinBUGS (OpenBUGS)<a class="anchor" aria-label="anchor" href="#computation-using-winbugs-openbugs-1"><i class="fas fa-link"></i></a>
</h3>
<p>Here, I am simply contrasting the computation from Stan to how BPM describes the computations using WinBUGS.
First, let’s take a look at the model described by BPM on p. 41.</p>
<pre><code># A model block
model{
  #################################
  # Prior distribution
  #################################
  theta ~ dbeta(alpha,beta)
  
  #################################
  # Conditional distribution of the data
  #################################
  for(j in 1:J){
    y[j] ~ dbern(theta)
  }
}
# data statement
list(J=10, y=c(1,0,1,0,1,1,1,1,0,1), alpha=6, beta=6)</code></pre>
<p>The code is similar to style to the code used for calling Stan.
However you’ll notice a difference in how a probability distribution is referenced.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># model code</span>
<span class="va">model.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">w.d</span>,<span class="st">"/code/Bernoulli/Bernoulli Model.bug"</span><span class="op">)</span>

<span class="co"># get data file</span>
<span class="va">data.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">w.d</span>,<span class="st">"/code/Bernoulli/Bernoulli data.txt"</span><span class="op">)</span>

<span class="co"># starting values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">openbugs</span><span class="op">(</span>
  data<span class="op">=</span> <span class="va">data.file</span>, 
  model.file <span class="op">=</span> <span class="va">model.file</span>, <span class="co"># R grabs the file and runs it in openBUGS</span>
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  inits<span class="op">=</span><span class="va">start_values</span>,
  n.chains <span class="op">=</span> <span class="fl">4</span>,
  n.iter <span class="op">=</span> <span class="fl">2000</span>,
  n.burnin <span class="op">=</span> <span class="fl">1000</span>,
  n.thin <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="va">posterior</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">sims.matrix</span>

<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">posterior</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="va">plot_title</span>


<span class="va">MLE</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>
<span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">prior.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span>, dens <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Posterior"</span><span class="op">=</span><span class="st">"#0072B2"</span>, <span class="st">"Prior"</span><span class="op">=</span><span class="st">"#E69F00"</span>, <span class="st">"MLE"</span><span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="co">#"#56B4E9", "#E69F00" "#CC79A7"</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span>,
               <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">theta</span>, color<span class="op">=</span><span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">prior.dat</span>,
            <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">dens</span>, color<span class="op">=</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">MLE</span>, color<span class="op">=</span><span class="st">"MLE"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Posterior density comparedto prior and MLE"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cols</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="computation-using-jags-r2jags-1" class="section level3" number="2.2.3">
<h3>
<span class="header-section-number">2.2.3</span> Computation using JAGS (R2jags)<a class="anchor" aria-label="anchor" href="#computation-using-jags-r2jags-1"><i class="fas fa-link"></i></a>
</h3>
<p>Here, I utilize JAGS, which is nearly identical to WinBUGS in how the underlying mechanics work to compute the posterior but is easily to use through R.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># model code</span>
<span class="va">jags.model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="co">#################################</span>
  <span class="co"># Conditional distribution of the data</span>
  <span class="co">#################################</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu">dbern</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="co">#################################</span>
  <span class="co"># Prior distribution</span>
  <span class="co">#################################</span>
  <span class="va">theta</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">alpha</span>,<span class="va">beta</span><span class="op">)</span>
  
<span class="op">}</span>
<span class="co"># data</span>
<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  J <span class="op">=</span> <span class="fl">10</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="cn">NA</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
  alpha <span class="op">=</span> <span class="fl">6</span>,
  beta <span class="op">=</span> <span class="fl">6</span>
<span class="op">)</span>

<span class="co"># starting values</span>
<span class="va">start_values</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>
  model.file<span class="op">=</span><span class="va">jags.model</span>,
  data<span class="op">=</span><span class="va">mydata</span>,
  inits<span class="op">=</span><span class="va">start_values</span>,
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  n.iter<span class="op">=</span><span class="fl">1000</span>,
  n.burnin <span class="op">=</span> <span class="fl">500</span>,
  n.chains <span class="op">=</span> <span class="fl">4</span>,
  n.thin<span class="op">=</span><span class="fl">1</span>,
  progress.bar <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 9
##    Unobserved stochastic nodes: 2
##    Total graph size: 14
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Bugs model at "C:/Users/noahp/AppData/Local/Temp/RtmpQR8sbs/model454429615b74.txt", fit using jags,
##  4 chains, each with 1000 iterations (first 500 discarded)
##  n.sims = 2000 iterations saved
##          mu.vect sd.vect   2.5%    25%    50%    75%  97.5%  Rhat n.eff
## theta      0.570   0.105  0.359  0.498  0.572  0.644  0.764 1.003  1200
## deviance  12.223   0.991 11.458 11.548 11.849 12.511 14.968 1.005   700
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 0.5 and DIC = 12.7
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract posteriors for all chains</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu">as.mcmc</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>

<span class="fu">R2jags</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/R2jags/man/traceplot.html">traceplot</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span></code></pre></div>
<p><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-jags-1.png" width="90%" height="90%"><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-jags-2.png" width="90%" height="90%"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert to singel data.frame for density plot</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">jags.mcmc</span>, chains<span class="op">=</span><span class="cn">T</span>, iters <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"chain"</span>, <span class="st">"iter"</span>, <span class="va">a</span><span class="op">)</span>


<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> 
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-jags-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MLE</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>
<span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span>
<span class="va">prior.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">x</span>, dens <span class="op">=</span> <span class="fu">prior</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Posterior"</span><span class="op">=</span><span class="st">"#0072B2"</span>, <span class="st">"Prior"</span><span class="op">=</span><span class="st">"#E69F00"</span>, <span class="st">"MLE"</span><span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="co">#"#56B4E9", "#E69F00" "#CC79A7"</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>data<span class="op">=</span><span class="va">plot.data</span>,
               <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">theta</span>, color<span class="op">=</span><span class="st">"Posterior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>data<span class="op">=</span><span class="va">prior.dat</span>,
            <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">dens</span>, color<span class="op">=</span><span class="st">"Prior"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept<span class="op">=</span><span class="va">MLE</span>, color<span class="op">=</span><span class="st">"MLE"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Posterior density comparedto prior and MLE"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cols</span>, name<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp2-beta-bern-fit-jags-4.png" width="90%" height="90%"></div>
<!-- You can label chapter and section titles using `{#label}` after them, e.g., we can reference Chapter \@ref(intro). If you do not manually label them, there will be automatic labels anyway, e.g., Chapter \@ref(methods). -->
<!-- Figures and tables with captions will be placed in `figure` and `table` environments, respectively. -->
<!-- ```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'} -->
<!-- par(mar = c(4, 4, .1, .1)) -->
<!-- plot(pressure, type = 'b', pch = 19) -->
<!-- ``` -->
<!-- Reference a figure by its code chunk label with the `fig:` prefix, e.g., see Figure \@ref(fig:nice-fig). Similarly, you can reference tables generated from `knitr::kable()`, e.g., see Table \@ref(tab:nice-tab). -->
<!-- ```{r nice-tab, tidy=FALSE} -->
<!-- knitr::kable( -->
<!--   head(iris, 20), caption = 'Here is a nice table!', -->
<!--   booktabs = TRUE -->
<!-- ) -->
<!-- ``` -->
<!-- You can write citations, too. For example, we are using the **bookdown** package [@R-bookdown] in this sample book, which was built on top of R Markdown and **knitr** [@xie2015]. -->

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html"><span class="header-section-number">1</span> Index</a></div>
<div class="next"><a href="conceptual-issues-in-bayesian-inference.html"><span class="header-section-number">3</span> Conceptual Issues in Bayesian Inference</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chp2"><span class="header-section-number">2</span> Introduction to Bayesian Inference</a></li>
<li>
<a class="nav-link" href="#beta-binomial-example"><span class="header-section-number">2.1</span> Beta-binomial Example</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#computation-using-stan"><span class="header-section-number">2.1.1</span> Computation using Stan</a></li>
<li><a class="nav-link" href="#computation-using-winbugs-openbugs"><span class="header-section-number">2.1.2</span> Computation using WinBUGS (OpenBUGS)</a></li>
<li><a class="nav-link" href="#computation-using-jags-r2jags"><span class="header-section-number">2.1.3</span> Computation using JAGS (R2jags)</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#beta-bernoulli-example"><span class="header-section-number">2.2</span> Beta-Bernoulli Example</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#computation-using-stan-1"><span class="header-section-number">2.2.1</span> Computation using Stan</a></li>
<li><a class="nav-link" href="#computation-using-winbugs-openbugs-1"><span class="header-section-number">2.2.2</span> Computation using WinBUGS (OpenBUGS)</a></li>
<li><a class="nav-link" href="#computation-using-jags-r2jags-1"><span class="header-section-number">2.2.3</span> Computation using JAGS (R2jags)</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling/blob/master/02-intro-bayes.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling/edit/master/02-intro-bayes.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</strong>" was written by R. Noah Padgett. It was last built on 2022-07-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
