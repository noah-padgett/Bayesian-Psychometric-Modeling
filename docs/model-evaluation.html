<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Model Evaluation | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</title>
<meta name="author" content="R. Noah Padgett">
<meta name="description" content="The goal of evaluating the model is to determine if the inferences suggested by the model are reasonable based one’s content area knowledge. The text and (BDA3) say that this evaluation of...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 10 Model Evaluation | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy">
<meta property="og:type" content="book">
<meta property="og:description" content="The goal of evaluating the model is to determine if the inferences suggested by the model are reasonable based one’s content area knowledge. The text and (BDA3) say that this evaluation of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Model Evaluation | Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy">
<meta name="twitter:description" content="The goal of evaluating the model is to determine if the inferences suggested by the model are reasonable based one’s content area knowledge. The text and (BDA3) say that this evaluation of...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li class="book-part">Foundations</li>
<li><a class="" href="overview.html"><span class="header-section-number">1</span> Overview</a></li>
<li><a class="" href="chp2.html"><span class="header-section-number">2</span> Introduction to Bayesian Inference</a></li>
<li><a class="" href="conceptual-issues-in-bayesian-inference.html"><span class="header-section-number">3</span> Conceptual Issues in Bayesian Inference</a></li>
<li><a class="" href="normal-distribution-models.html"><span class="header-section-number">4</span> Normal Distribution Models</a></li>
<li><a class="" href="markov-chain-monte-carlo-estimation.html"><span class="header-section-number">5</span> Markov Chain Monte Carlo Estimation</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">6</span> Regression</a></li>
<li class="book-part">Psychometrics</li>
<li><a class="" href="canonical-bayesian-psychometric-modeling.html"><span class="header-section-number">7</span> Canonical Bayesian Psychometric Modeling</a></li>
<li><a class="" href="classical-test-theory.html"><span class="header-section-number">8</span> Classical Test Theory</a></li>
<li><a class="" href="confirmatory-factor-analysis.html"><span class="header-section-number">9</span> Confirmatory Factor Analysis</a></li>
<li><a class="active" href="model-evaluation.html"><span class="header-section-number">10</span> Model Evaluation</a></li>
<li><a class="" href="item-response-theory.html"><span class="header-section-number">11</span> Item Response Theory</a></li>
<li><a class="" href="missing-data-modeling.html"><span class="header-section-number">12</span> Missing Data Modeling</a></li>
<li><a class="" href="latent-class-analysis.html"><span class="header-section-number">13</span> Latent Class Analysis</a></li>
<li><a class="" href="bayesian-networks.html"><span class="header-section-number">14</span> Bayesian Networks</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="model-evaluation" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Model Evaluation<a class="anchor" aria-label="anchor" href="#model-evaluation"><i class="fas fa-link"></i></a>
</h1>
<p>The goal of evaluating the model is to determine if the inferences suggested by the model are <em>reasonable</em> based one’s content area knowledge.
The text and (BDA3) say that this evaluation of reasonableness is really a form of prior, that is
“Gelman et al. (2013) argued tha when analysts deem that the posterior distribution and inferences are unreasonable, what they are really expressing is that there is additional information available that was not included in the analysis.”
Having some knowledge about what the posterior distribution <em>should</em> look like can be extremely helpful in developing how the model takes shape (e.g., setting reasonable boundaries on parameters).</p>
<p>Three aspects/questions we aim to address as part of the logic of model checking:</p>
<ol style="list-style-type: decimal">
<li>What is going on in our data, possibly in relation to the model?</li>
<li>What the model has to say about what should be going on?</li>
<li>How what is going on in the data compared to what the model says should be going on?</li>
</ol>
<p>Model evaluation is accomplished through</p>
<ol style="list-style-type: decimal">
<li>Residual analysis,</li>
<li>Posterior predictive distributions, and</li>
<li>Model comparisons.</li>
</ol>
<div id="residual-analysis" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Residual Analysis<a class="anchor" aria-label="anchor" href="#residual-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>A residual is a key component of analysis in many statistical procedures.
Here, we describe how this important feature can be used in Bayesian psychometric analysis.
At a fundamental level, a residual is one component in the data-model relationship, that is
<span class="math display">\[DATA = MODEL + RESIDUALS.\]</span>
This view highlights the three major pieces we are going to use in the model evaluation process.
We can rewrite the above to focus on the residuals as well.</p>
<p>In factor analysis (CFA in particular), we tend to be interested in the residuals of the covariances among variables because our factor model is a hypothesis for how the observed variables are interrelated.
In the observed data, we capture this relationship with the observed sample covariance matrix <span class="math inline">\(\mathbf{S}\)</span>, which for variable <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span> is usually computed as
<span class="math display">\[s_{jk} = \frac{\sum_{\forall i (x_{ij}-\bar{x}_j)(x_{ik}-\bar{x}_k)}}{n-1}.\]</span>
And, the whole covariance matrix is <span class="math inline">\(\mathbf{S} = \frac{1}{n-1}\mathbf{X}^{\prime}\mathbf{X}\)</span> where <span class="math inline">\(\mathbf{X}\)</span> is in centered form.</p>
<p>In CFA, we can get the model implied covariance matrix by using the estimated parameters to get <span class="math inline">\(\Sigma(\theta)\)</span>, that is
<span class="math display">\[\Sigma(\theta) = \Lambda\Phi\Lambda^{\prime} + \Psi.\]</span>
Then, to get the residual matrix we simple find the difference scores (<span class="math inline">\(\mathbf{E}\)</span>) between these matrices
<span class="math display">\[\mathbf{E} = \mathbf{S} - \Sigma(\theta).\]</span>
Although, we would probably want to rescale <span class="math inline">\(\mathbf{S}\)</span> and <span class="math inline">\(\Sigma(\theta)\)</span> to be correlation matrices because the scale of the covariances and variances are likely not of primary interest.
This means we can use the residuals correlations instead.</p>
<p>Generating the residual correlations is accomplished using the posterior predictive distribution.</p>
</div>
<div id="posterior-predictive-distributions" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Posterior Predictive Distributions<a class="anchor" aria-label="anchor" href="#posterior-predictive-distributions"><i class="fas fa-link"></i></a>
</h2>
<p>The posterior predictive distribution is used heavily in model evaluation.</p>
<p>(look at Bayes notes)</p>
<p>Basically, the posterior predictive distribution is the what values of the <em>observed</em> data (<span class="math inline">\(Y\)</span>) are mostly likely given the posterior distribution.</p>
<div id="example-of-posterior-predictive-distribution-of-correlations" class="section level3" number="10.2.1">
<h3>
<span class="header-section-number">10.2.1</span> Example of posterior predictive distribution of correlations<a class="anchor" aria-label="anchor" href="#example-of-posterior-predictive-distribution-of-correlations"><i class="fas fa-link"></i></a>
</h3>
<p>In this example, we use the correlations of the observed variable as the function of interest.</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># model code</span>
<span class="va">jags.model.cfa</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>

<span class="co">#</span>
<span class="co"># Specify the factor analysis measurement</span>
<span class="co"># model for the observables</span>
<span class="co">#</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="co"># model implied expectation for each observable</span>
      <span class="va">mu</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tau</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="va">ksi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
      <span class="co"># distribution for each observable</span>
      <span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>, <span class="va">inv.psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>    
    <span class="op">}</span>
  <span class="op">}</span>
  
<span class="co">########################################</span>
  <span class="co"># Specify the (prior) distribution for </span>
  <span class="co"># the latent variables</span>
  <span class="co">########################################</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
    <span class="co"># distribution for the latent variables</span>
    <span class="va">ksi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">kappa</span>, <span class="va">inv.phi</span><span class="op">)</span>  
  <span class="op">}</span>
  
  
  <span class="co">########################################</span>
  <span class="co"># Specify the prior distribution for the</span>
  <span class="co"># parameters that govern the latent variables</span>
  <span class="co">########################################</span>
  <span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fl">0</span>              <span class="co"># Mean of factor 1</span>
  <span class="va">inv.phi</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Precision of factor 1</span>
  <span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">inv.phi</span>        <span class="co"># Variance of factor 1</span>
  
  
  <span class="co">########################################</span>
  <span class="co"># Specify the prior distribution for the</span>
  <span class="co"># measurement model parameters</span>
  <span class="co">########################################</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tau</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">.1</span><span class="op">)</span>        <span class="co"># Intercepts for observables</span>
    <span class="va">inv.psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Precisions for observables</span>
    <span class="va">psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">inv.psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>   <span class="co"># Variances for observables</span>
  <span class="op">}</span>
  
  <span class="va">lambda</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>              <span class="co"># loading fixed to 1.0 </span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="va">lambda</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.1</span><span class="op">)</span>    <span class="co"># prior distribution for the remaining loadings</span>
  <span class="op">}</span>

<span class="op">}</span>
<span class="co"># data must be in a list</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"code/CFA-One-Latent-Variable/Data/IIS.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">500</span>, J <span class="op">=</span> <span class="fl">5</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lambda["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span>, <span class="st">"phi"</span>, <span class="st">"psi"</span><span class="op">)</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>
  model.file<span class="op">=</span><span class="va">jags.model.cfa</span>,
  data<span class="op">=</span><span class="va">mydata</span>,
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  n.iter<span class="op">=</span><span class="fl">15000</span>,
  n.burnin <span class="op">=</span> <span class="fl">5000</span>,
  n.chains <span class="op">=</span> <span class="fl">1</span>, <span class="co"># for simplicity</span>
  n.thin<span class="op">=</span><span class="fl">1</span>,
  progress.bar <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 2500
##    Unobserved stochastic nodes: 515
##    Total graph size: 8029
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Bugs model at "C:/Users/noahp/AppData/Local/Temp/RtmpQR8sbs/model4544238f163c.txt", fit using jags,
##  1 chains, each with 15000 iterations (first 5000 discarded)
##  n.sims = 10000 iterations saved
##            mu.vect sd.vect     2.5%      25%      50%      75%    97.5%
## lambda[1]    1.000   0.000    1.000    1.000    1.000    1.000    1.000
## lambda[2]    0.730   0.045    0.645    0.699    0.729    0.760    0.820
## lambda[3]    0.420   0.037    0.349    0.395    0.420    0.445    0.493
## lambda[4]    1.050   0.065    0.928    1.005    1.049    1.094    1.182
## lambda[5]    0.985   0.059    0.873    0.944    0.983    1.024    1.104
## phi          0.435   0.042    0.358    0.406    0.433    0.462    0.524
## psi[1]       0.373   0.028    0.322    0.353    0.373    0.392    0.433
## psi[2]       0.182   0.014    0.156    0.172    0.181    0.191    0.211
## psi[3]       0.180   0.012    0.157    0.171    0.179    0.187    0.205
## psi[4]       0.378   0.030    0.322    0.357    0.377    0.398    0.439
## psi[5]       0.266   0.022    0.226    0.251    0.265    0.280    0.311
## tau[1]       3.333   0.040    3.254    3.306    3.332    3.360    3.410
## tau[2]       3.898   0.028    3.843    3.878    3.897    3.917    3.953
## tau[3]       4.596   0.023    4.551    4.580    4.596    4.611    4.640
## tau[4]       3.034   0.041    2.955    3.007    3.033    3.062    3.115
## tau[5]       3.712   0.037    3.641    3.687    3.713    3.737    3.784
## deviance  3379.879  42.773 3298.914 3350.714 3379.396 3407.878 3466.261
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 914.8 and DIC = 4294.7
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp10-corr-1.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract posteriors for all chains</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu">as.mcmc</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>


<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">jags.mcmc</span>, chains<span class="op">=</span><span class="cn">T</span>, iters <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"chain"</span>, <span class="st">"iter"</span>, <span class="va">a</span><span class="op">)</span>


<span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Posterior distributions"</span>,
                      <span class="st">"with medians and 80% intervals"</span><span class="op">)</span>
<span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"tau["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp10-corr-2.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lambda["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp10-corr-3.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mcmc_areas</span><span class="op">(</span>
  <span class="va">plot.data</span>,
  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"psi["</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"]"</span><span class="op">)</span>, <span class="st">"phi"</span><span class="op">)</span>,
  prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="va">plot_title</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp10-corr-4.png" width="90%" height="90%"></div>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compute model implied covariance/correlations</span>
<span class="co"># for each iterations</span>
<span class="va">out.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">10</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">out.mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"r12"</span>, <span class="st">"r13"</span>, <span class="st">"r14"</span>, <span class="st">"r15"</span>, <span class="st">"r23"</span>, <span class="st">"r24"</span>, <span class="st">"r25"</span>, <span class="st">"r34"</span>,<span class="st">"r35"</span>, <span class="st">"r45"</span><span class="op">)</span>
<span class="va">plot.data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">plot.data</span>,<span class="va">out.mat</span><span class="op">)</span>

<span class="co"># compute the model implied correlations for each iterations</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">plot.data1</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
  <span class="va">phi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
  <span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
  <span class="va">micov</span> <span class="op">&lt;-</span> <span class="va">lambda</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">phi</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">+</span><span class="va">psi</span>
  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">micov</span><span class="op">)</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">5</span>, nrow<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
  <span class="va">Dinv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span>
  <span class="va">micor</span> <span class="op">&lt;-</span> <span class="va">Dinv</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">micov</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">Dinv</span>
  <span class="va">outr</span> <span class="op">&lt;-</span> <span class="va">micor</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">micor</span><span class="op">)</span><span class="op">]</span>
  <span class="co"># combine</span>
  <span class="va">plot.data1</span><span class="op">[</span><span class="va">i</span>,<span class="fl">20</span><span class="op">:</span><span class="fl">29</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">outr</span>
<span class="op">}</span>

<span class="va">obs.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,byrow<span class="op">=</span><span class="cn">T</span>,
                  ncol<span class="op">=</span><span class="fl">10</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">plot.data</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">obs.mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ObsR12"</span>, <span class="st">"ObsR13"</span>, <span class="st">"ObsR14"</span>, <span class="st">"ObsR15"</span>, <span class="st">"ObsR23"</span>, <span class="st">"ObsR24"</span>, <span class="st">"ObsR25"</span>, <span class="st">"ObsR34"</span>,<span class="st">"ObsR35"</span>, <span class="st">"ObsR45"</span><span class="op">)</span>
<span class="va">plot.data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">plot.data1</span>,<span class="va">obs.mat</span><span class="op">)</span>


<span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">textGrob</a></span><span class="op">(</span><span class="st">'PI'</span><span class="op">)</span>
<span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">textGrob</a></span><span class="op">(</span><span class="st">'AD'</span><span class="op">)</span>
<span class="va">t3</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">textGrob</a></span><span class="op">(</span><span class="st">'IGC'</span><span class="op">)</span>
<span class="va">t4</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">textGrob</a></span><span class="op">(</span><span class="st">'FI'</span><span class="op">)</span>
<span class="va">t5</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">textGrob</a></span><span class="op">(</span><span class="st">'FC'</span><span class="op">)</span>
<span class="va">p12</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r12</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR12</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p13</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r13</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR13</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p14</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r14</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR14</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p15</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r15</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR15</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p23</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r23</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR23</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p24</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r24</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR24</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p25</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r25</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR25</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p34</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r34</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR34</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p35</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r35</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR35</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p45</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.data1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">r45</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">ObsR45</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="cn">NULL</span>,y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.line.y<span class="op">=</span><span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">layout</span> <span class="op">&lt;-</span> <span class="st">'
A####
BC###
DEF##
GHIJ#
KLMNO
'</span>
<span class="fu">wrap_plots</span><span class="op">(</span>A<span class="op">=</span><span class="va">t1</span>,C<span class="op">=</span><span class="va">t2</span>,F<span class="op">=</span><span class="va">t3</span>,J<span class="op">=</span><span class="va">t4</span>,O<span class="op">=</span><span class="va">t5</span>,
           B<span class="op">=</span><span class="va">p12</span>,D<span class="op">=</span><span class="va">p13</span>,G<span class="op">=</span><span class="va">p14</span>,K<span class="op">=</span><span class="va">p15</span>,
           E<span class="op">=</span><span class="va">p23</span>,H<span class="op">=</span><span class="va">p24</span>,L<span class="op">=</span><span class="va">p25</span>,
           I<span class="op">=</span><span class="va">p34</span>,M<span class="op">=</span><span class="va">p35</span>,
           N<span class="op">=</span><span class="va">p45</span>,design <span class="op">=</span> <span class="va">layout</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp10-corr-5.png" width="90%" height="90%"></div>
</div>
<div id="ppd-srmr" class="section level3" number="10.2.2">
<h3>
<span class="header-section-number">10.2.2</span> PPD SRMR<a class="anchor" aria-label="anchor" href="#ppd-srmr"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># model code</span>
<span class="va">jags.model.cfa</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>

  <span class="co">########################################</span>
  <span class="co"># Specify the factor analysis measurement</span>
  <span class="co"># model for the observables</span>
  <span class="co">########################################</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
      <span class="co"># model implied expectation for each observable</span>
      <span class="va">mu</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tau</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="va">ksi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
      <span class="co"># distribution for each observable</span>
      <span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span>, <span class="va">inv.psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>  
      <span class="co"># Posterior Predictive Distribution of x</span>
      <span class="co">#   needed for SRMR</span>
      <span class="co">#   set mean to 0</span>
      <span class="co"># x.ppd[i,j] ~ dnorm(0, inv.psi[j])  </span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="co">########################################</span>
  <span class="co"># Specify the (prior) distribution for </span>
  <span class="co"># the latent variables</span>
  <span class="co">########################################</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">{</span>
    <span class="co"># distribution for the latent variables</span>
    <span class="va">ksi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">kappa</span>, <span class="va">inv.phi</span><span class="op">)</span>  
  <span class="op">}</span>
  
  
  <span class="co">########################################</span>
  <span class="co"># Specify the prior distribution for the</span>
  <span class="co"># parameters that govern the latent variables</span>
  <span class="co">########################################</span>
  <span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fl">0</span>              <span class="co"># Mean of factor 1</span>
  <span class="va">inv.phi</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Precision of factor 1</span>
  <span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">inv.phi</span>        <span class="co"># Variance of factor 1</span>
  
  
  <span class="co">########################################</span>
  <span class="co"># Specify the prior distribution for the</span>
  <span class="co"># measurement model parameters</span>
  <span class="co">########################################</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="va">tau</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">.1</span><span class="op">)</span>        <span class="co"># Intercepts for observables</span>
    <span class="va">inv.psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Precisions for observables</span>
    <span class="va">psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">inv.psi</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>   <span class="co"># Variances for observables</span>
  <span class="op">}</span>
  
  <span class="va">lambda</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>              <span class="co"># loading fixed to 1.0 </span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
    <span class="va">lambda</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.1</span><span class="op">)</span>    <span class="co"># prior distribution for the remaining loadings</span>
  <span class="op">}</span>

<span class="op">}</span>
<span class="co"># data must be in a list</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"code/CFA-One-Latent-Variable/Data/IIS.dat"</span>, header<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  n <span class="op">=</span> <span class="fl">500</span>, J <span class="op">=</span> <span class="fl">5</span>,
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># vector of all parameters to save</span>
<span class="va">param_save</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"lambda["</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="st">"]"</span><span class="op">)</span>, <span class="st">"phi"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="co"># "Sigma",</span>

<span class="co"># fit model</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span>
  model.file<span class="op">=</span><span class="va">jags.model.cfa</span>,
  data<span class="op">=</span><span class="va">mydata</span>,
  <span class="co">#inits=start_values,</span>
  parameters.to.save <span class="op">=</span> <span class="va">param_save</span>,
  n.iter<span class="op">=</span><span class="fl">10000</span>,
  n.burnin <span class="op">=</span> <span class="fl">5000</span>,
  n.chains <span class="op">=</span> <span class="fl">1</span>,
  n.thin<span class="op">=</span><span class="fl">1</span>,
  progress.bar <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 2500
##    Unobserved stochastic nodes: 515
##    Total graph size: 8029
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Inference for Bugs model at "C:/Users/noahp/AppData/Local/Temp/RtmpQR8sbs/model4544704352f.txt", fit using jags,
##  1 chains, each with 10000 iterations (first 5000 discarded)
##  n.sims = 5000 iterations saved
##            mu.vect sd.vect     2.5%      25%      50%      75%    97.5%
## lambda[1]    1.000   0.000    1.000    1.000    1.000    1.000    1.000
## lambda[2]    0.730   0.044    0.647    0.699    0.729    0.759    0.820
## lambda[3]    0.420   0.037    0.349    0.395    0.419    0.445    0.495
## lambda[4]    1.052   0.067    0.925    1.006    1.051    1.096    1.188
## lambda[5]    0.984   0.058    0.874    0.943    0.983    1.022    1.102
## phi          0.435   0.042    0.360    0.405    0.433    0.463    0.520
## psi[1]       0.373   0.028    0.322    0.354    0.372    0.392    0.432
## psi[2]       0.182   0.014    0.157    0.173    0.182    0.191    0.211
## psi[3]       0.180   0.012    0.157    0.171    0.179    0.188    0.205
## psi[4]       0.377   0.030    0.322    0.357    0.376    0.396    0.439
## psi[5]       0.266   0.022    0.225    0.251    0.266    0.281    0.311
## tau[1]       3.333   0.041    3.253    3.306    3.333    3.360    3.412
## tau[2]       3.897   0.029    3.840    3.877    3.898    3.917    3.954
## tau[3]       4.596   0.023    4.552    4.581    4.596    4.611    4.640
## tau[4]       3.033   0.042    2.952    3.005    3.034    3.062    3.115
## tau[5]       3.712   0.037    3.638    3.686    3.713    3.737    3.784
## deviance  3381.034  41.985 3299.407 3352.431 3380.812 3409.296 3463.769
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 881.4 and DIC = 4262.4
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract posteriors for all chains</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu">as.mcmc</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="co"># function for estimating SRMR</span>
<span class="va">SRMR.function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data.cov.matrix</span>, <span class="va">mod.imp.cov.matrix</span><span class="op">)</span><span class="op">{</span>

  <span class="va">J</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data.cov.matrix</span><span class="op">)</span>
    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">J</span>, ncol<span class="op">=</span><span class="va">J</span><span class="op">)</span>

    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span>
        <span class="kw">for</span><span class="op">(</span><span class="va">jprime</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">j</span><span class="op">)</span><span class="op">{</span>
            <span class="va">temp</span><span class="op">[</span><span class="va">j</span>, <span class="va">jprime</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">data.cov.matrix</span><span class="op">[</span><span class="va">j</span>, <span class="va">jprime</span><span class="op">]</span> <span class="op">-</span> <span class="va">mod.imp.cov.matrix</span><span class="op">[</span><span class="va">j</span>, <span class="va">jprime</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">data.cov.matrix</span><span class="op">[</span><span class="va">j</span>, <span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">data.cov.matrix</span><span class="op">[</span><span class="va">jprime</span>, <span class="va">jprime</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
        <span class="op">}</span>
    <span class="op">}</span>

    <span class="va">SRMR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">temp</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">J</span><span class="op">*</span><span class="op">(</span><span class="va">J</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="va">SRMR</span>

<span class="op">}</span>

<span class="co"># set up the parameters for </span>
<span class="co">#   (1) model implied covariance</span>
<span class="co">#   (2) PPD of x/covariance</span>
<span class="va">iter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>
<span class="va">srmr.realized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">iter</span><span class="op">)</span>
<span class="va">srmr.ppd</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">iter</span><span class="op">)</span>
<span class="va">srmr.rpv</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">iter</span><span class="op">)</span>
<span class="va">jags.mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">jags.mcmc</span>, <span class="va">srmr.realized</span>, <span class="va">srmr.ppd</span>, <span class="va">srmr.rpv</span><span class="op">)</span>

<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span>; <span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">5</span>; <span class="va">M</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">cov.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">iter</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># set up parameters</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">jags.mcmc</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>
  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, ncol<span class="op">=</span><span class="va">M</span>, nrow<span class="op">=</span><span class="va">J</span><span class="op">)</span>
  <span class="va">phi</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>, ncol<span class="op">=</span><span class="va">M</span>, nrow<span class="op">=</span><span class="va">M</span><span class="op">)</span>
  <span class="va">psi</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>, ncol<span class="op">=</span><span class="va">J</span>, nrow<span class="op">=</span><span class="va">J</span><span class="op">)</span>
  <span class="co"># estimate model implied covariance matrix</span>
  <span class="va">cov.imp</span> <span class="op">&lt;-</span> <span class="va">lambda</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">phi</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">+</span> <span class="va">psi</span>
  <span class="co"># get posterior predicted observed x</span>
  <span class="va">x.ppd</span>   <span class="op">&lt;-</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html">rmvnorm</a></span><span class="op">(</span><span class="va">N</span>, mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">J</span><span class="op">)</span>, sigma<span class="op">=</span><span class="va">cov.imp</span><span class="op">)</span>
  <span class="co"># compute posterior predictied covariance matrix</span>
  <span class="va">cov.ppd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">x.ppd</span><span class="op">)</span>
  <span class="co"># estimate SRMR values </span>
  <span class="va">jags.mcmc</span><span class="op">[</span><span class="va">i</span>,<span class="fl">18</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">SRMR.function</span><span class="op">(</span><span class="va">cov.x</span>, <span class="va">cov.imp</span><span class="op">)</span><span class="co"># srmr realized</span>
  <span class="va">jags.mcmc</span><span class="op">[</span><span class="va">i</span>,<span class="fl">19</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">SRMR.function</span><span class="op">(</span><span class="va">cov.ppd</span>, <span class="va">cov.imp</span><span class="op">)</span><span class="co"># srmr ppd</span>
  <span class="co"># posterior predicted p-value of realized SRMR being &lt;= 0.08.</span>
  <span class="va">jags.mcmc</span><span class="op">[</span><span class="va">i</span>,<span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">[</span><span class="va">i</span>,<span class="fl">18</span><span class="op">]</span><span class="op">&lt;=</span><span class="fl">0.08</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> 
<span class="op">}</span>

<span class="va">plot.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">jags.mcmc</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.dat</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">srmr.realized</span>, y<span class="op">=</span><span class="va">srmr.ppd</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_abline</span><span class="op">(</span>slope<span class="op">=</span><span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Realized SRMR"</span>,y<span class="op">=</span><span class="st">"Posterior Predicted SRMR"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plot.dat</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">srmr.realized</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">lims</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Realized SRMR"</span>, y<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">0.75</span>, y <span class="op">=</span> <span class="fl">3</span>,
           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Pr(SRMR &lt;= 0.08)= "</span>,
                          <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">plot.dat</span><span class="op">$</span><span class="va">srmr.rpv</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                   axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
                   axis.ticks.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></code></pre></div>
<div class="inline-figure"><img src="bookdown-BPM_files/figure-html/chp10-srmr-1.png" width="90%" height="90%"></div>
</div>
</div>
<div id="model-comparison" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Model Comparison<a class="anchor" aria-label="anchor" href="#model-comparison"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Bayes Factors (BF)</li>
<li>Conditional predictive ordinate (CPO)</li>
<li>Information criteria</li>
<li>Entropy</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="confirmatory-factor-analysis.html"><span class="header-section-number">9</span> Confirmatory Factor Analysis</a></div>
<div class="next"><a href="item-response-theory.html"><span class="header-section-number">11</span> Item Response Theory</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#model-evaluation"><span class="header-section-number">10</span> Model Evaluation</a></li>
<li><a class="nav-link" href="#residual-analysis"><span class="header-section-number">10.1</span> Residual Analysis</a></li>
<li>
<a class="nav-link" href="#posterior-predictive-distributions"><span class="header-section-number">10.2</span> Posterior Predictive Distributions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#example-of-posterior-predictive-distribution-of-correlations"><span class="header-section-number">10.2.1</span> Example of posterior predictive distribution of correlations</a></li>
<li><a class="nav-link" href="#ppd-srmr"><span class="header-section-number">10.2.2</span> PPD SRMR</a></li>
</ul>
</li>
<li><a class="nav-link" href="#model-comparison"><span class="header-section-number">10.3</span> Model Comparison</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling/blob/master/10-model-evaluation.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/noah-padgett/Bayesian-Psychometric-Modeling/edit/master/10-model-evaluation.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Bayesian Psychometric Modeling (2016) by Roy Levy and Robert J. Mislevy</strong>" was written by R. Noah Padgett. It was last built on 2022-06-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
